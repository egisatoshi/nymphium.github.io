<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>インターン､など</title>
    <meta name="description" content="こんにちは､びしょ〜じょです｡というわけで富士通のインターンに行ってきました｡イェーイ御社〜〜ッ">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://nymphium.github.io/2015/10/03/intern_andother.html">
    <link rel="alternate" type="application/rss+xml" title="lilyum ensemble" href="http://nymphium.github.io/feed.xml">
  </head>

  <body>
<header class="site-header">
      <div class="wrapper">
        <a class="site-title" href="/">lilyum ensemble</a>
        <nav class="site-nav">
          <div class="trigger">
            <a class="page-link" href="/slide.html">Slides</a>
            <a class="page-link" href="/tags.html">Tags</a>
          </div>
        </nav>
      </div>
    </header>

    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
          <header class="post-header">
            <h1 class="post-title" itemprop="name headline">インターン､など</h1>
            <span class="post-meta">
              <time datetime="2015-10-03T00:00:00+09:00" itemprop="datePublished">Oct 3, 2015</time>
              <p>tag: &#91;<a href="/tags.html#雑感-ref">雑感</a><a href="/tags.html#Linux-ref">Linux</a><a href="/tags.html#sh-ref">sh</a>&#93;</p>
            </span>
            <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
            <script type="text/javascript" src="https://rawgit.com/JoelSutherland/GitHub-jQuery-Repo-Widget/master/jquery.githubRepoWidget.min.js"></script>
            <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
          </header>
          <div class="post-content" itemprop="articleBody">
            <p>こんにちは､びしょ〜じょです｡というわけで富士通のインターンに行ってきました｡イェーイ御社〜〜ッ</p>

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">ニャオ <a href="http://t.co/9hZg8PvOvX">pic.twitter.com/9hZg8PvOvX</a></p>&mdash; びしょ～じょ (@Nymphium) <a href="https://twitter.com/Nymphium/status/649174082974445568">September 30, 2015</a></blockquote>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>｢寝てた｣とか｢鹿を刎ねた｣とかしかインターンについてあまり触れていないので(まぁどちらも事実ですが)､OSSを触っていたので､成果は是非発信して欲しいということでね､うん｡</p>

<p>でも鹿を刎ねたのは本当にすごく興奮しまして｡高校の友人と静岡近辺を車で散策していたわけですが､4人のうちボクだけ自動車運転免許がなくて｡
伊豆半島からの帰りに山道を通ったわけだがそこでね､ドーンという感じに｡助手席に座っていたので大迫力だった｡
軽自動車に座っていて目線の高さが鹿の背中だったのでなかなか立派な鹿だったと思う｡交差点付近のため減速中だったので車が凹んだりはしなかった｡鹿も死ななかった｡
4人中ボクが一番興奮してドライバーが一番青ざめていた｡でもその1hくらい後にはドライバーも刎ねられた鹿の真似(?)を始めて､うん｡</p>

<hr>

<h2 id="btrfs-on-bcacheの性能調査">Btrfs on Bcacheの性能調査</h2>

<p>Linux3.10でメインラインにねじ込まれた､SSDを他のデバイスのキャッシュとして扱うという機能がBtrfsの上でもちゃんと動くのかということをまずひとつやった｡</p>

<p>Fedora22､社のデカいマシンの1ノードを使った｡X5690とかそのへんのが積んであった｡メモリが16GB｡</p>

<p>ベンチマークの自動化スクリプトではシェルスクリプトを500行くらい書いた｡ShellCheckの教えにより全然知らない記法などを覚えたり脳が柔軟になって<code>awk</code>1つで結果の統計が取れたりするようになった｡</p>

<p>FIOのパラメータ調整は職人感があって､メンターの方も以前やったベンチマークのパラメータを見せるだけで､｢あとはがんばってくれ｣という感じになった｡
FIOを使ったことがなかったのでパラメータ調節にはだいぶ手こずった｡最終的にはこんな感じだったと記憶している｡記憶の中なので違うかも｡</p>
<div class="highlight"><pre><code class="language-" data-lang="">[global]
stonewall
direct=1
bs=4m
size=40m
jobs=100
iodepth=32
io_dept_batch=32

[job1]
rw=randread

[job2]
rw=randwrite
</code></pre></div>
<h3 id="成果">成果</h3>

<p>結果はこんな感じ｡RAIDはBtrfsの機能で組んだやつ｡なので比較のXFSはシングルデバイスのみ｡
Btrfs RAIDもデバイス数は最小(RAID0は2つ､RAID5は3つ)｡BcacheのモードはWriteback｡単位はIOPS｡</p>

<table><thead>
<tr>
<th></th>
<th style="text-align: right">read</th>
<th style="text-align: right">write</th>
</tr>
</thead><tbody>
<tr>
<td>Btrfs Single</td>
<td style="text-align: right">500</td>
<td style="text-align: right">500</td>
</tr>
<tr>
<td>XFS Signle</td>
<td style="text-align: right">500</td>
<td style="text-align: right">500</td>
</tr>
<tr>
<td>Btrfs Single Bcached</td>
<td style="text-align: right">500</td>
<td style="text-align: right">3000</td>
</tr>
<tr>
<td>XFS Single Bcached</td>
<td style="text-align: right">500</td>
<td style="text-align: right">2200</td>
</tr>
<tr>
<td>Btrfs RAID0</td>
<td style="text-align: right">500</td>
<td style="text-align: right">500</td>
</tr>
<tr>
<td>Btrfs RAID5</td>
<td style="text-align: right">500</td>
<td style="text-align: right">80</td>
</tr>
<tr>
<td>Btrfs RAID0 Bcached</td>
<td style="text-align: right">500</td>
<td style="text-align: right">3300</td>
</tr>
<tr>
<td>Btrfs RAID5 Bcached</td>
<td style="text-align: right">500</td>
<td style="text-align: right">80</td>
</tr>
</tbody></table>

<p>RAID0がSingleと同じ速度というのはなんかおかしいんだよな…｡
SSDもHDDも型が古かったのでもう少しいいものを使えば結果が変わりそう｡
readはキャッシュに当たらないので変わらない｡Single/RAID0なら書き込みが6倍速という結果になった｡
Btrfsの他のモードはほとんど変わらなかったので割愛だにゃ｡他のRAIDとか､デバイス数との関係とかは皆さん頑張ってくれ給えよといった具合に｡
RAMをブロックデバイスにしてSSDのキャッシュデバイスにするとかできるのかな､できたら楽しそう｡</p>

<h3 id="bcacheについて">Bcacheについて</h3>

<p>ファックです｡ベンチマーク自動化スクリプトの一番の障害だったのがBcacheです｡まぁ<code>make-bcache</code>は許すよ｡うん｡
でも解除の方法が適当なファイルに1やUUIDを書き込んで<code>wipefs</code>でキレイにするというね､面倒｡
うっかり変なファイルに書き込むとカーネルパニックしたりBcache作成時に何故かカーネルパニックしたり､お前なんでマージされたんだよ…｡</p>

<h3 id="インターンについて">インターンについて</h3>

<p>というわけでね､上記ともうひとつやったけどこれは成果0なので割愛｡</p>

<p>社員寮に1ヶ月住んで､休日は本を読んだり港へ行ったり山を登ったり､友人と静岡旅行したりとそれなりに楽しかったが､平日はつらかった｡
寮なのになぜか社までバスで40分もかかるところに立地しており朝は0700くらいにおきる必要があった｡
帰ってからもめぼしい飲食店はなく､唯一まともだった大勝軒ディストリビューションに行くか､あるいは近所の薬局で50%引きの食パンを食べては枕を濡らす日々だった｡</p>

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">楽しいインターンの様子 <a href="http://t.co/OJOVeTf32h">pic.twitter.com/OJOVeTf32h</a></p>&mdash; びしょ～じょ (@Nymphium) <a href="https://twitter.com/Nymphium/status/639759336818933760">September 4, 2015</a></blockquote>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">ヤマノススメ 沼津アルプス <a href="http://t.co/dBRAKs6mu3">pic.twitter.com/dBRAKs6mu3</a></p>&mdash; びしょ～じょ (@Nymphium) <a href="https://twitter.com/Nymphium/status/642560500388130816">September 12, 2015</a></blockquote>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">浜松 <a href="http://t.co/2zqTcTwM6t">pic.twitter.com/2zqTcTwM6t</a></p>&mdash; びしょ～じょ (@Nymphium) <a href="https://twitter.com/Nymphium/status/646147815660392448">September 22, 2015</a></blockquote>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>ボクが配属された部署は社の中でもだいぶ特殊なようで､にわかに恐れていた挨拶をしないと殺されるとかそういう感じでは全く無くて安心した｡
会社ではまぁ普通に｡先述の通りベンチマークを眺めながらだんだん意識が遠のき…とかカフェオレを飲みまくって腹を壊してトイレにこもるというのを日中何回もやったりしていた｡
技術的な議論がよく聞こえてきて面白かった(小並感)｡
最終日前日はもうやることがなくなったのでサーバールームや社員研修として社の概要や変遷を聞くコースなどに行き､京の1ノードや海底の光ケーブルなどを見た｡</p>

<p>インターンは他の営業所でも行われており､最終日は横浜でそのインターン生たちの成果発表会という感じで発表をした｡
人数が70人くらい居たので､8人ほどのグループに分けられてその中で発表という形になった｡
SEなどのみならず営業のインターンとかもあって､その発表では本当に圧倒的成長みたいな感じで…｢サークルにバイトがんばってます! 将来は自分に何ができるかを考えて､営業でお客様に笑顔を届けるのがry｣…正直聞いててげっそりした｡
でもVirtuora NCでXMLで設計を書けばちょっとしたネットワークを簡単に作れるし監視などもできるしみたいな発表は面白かった｡Fujitsuの製品なのでメンターも気合が入っていたんだろう｡</p>

<p>で､沼津工場にはボクの他に2人いたわけだが､一人はOpenStack上に構築したブツをIronicを用いて物理マシンにスッと置くということをやっていた｡
もう一人はDockerの調査でrunCとか調べてた｡</p>

<p>沼津編おわり</p>

<hr>

<h2 id="github-pagesとjekyll">GitHub PagesとJekyll</h2>

<p>当サイトがね､うん｡</p>

<p>Jekyllのプラギンなどを用いてスマートに書きたいということで､<a href="http://gosyujin.github.io/2013/05/21/jekyll-plugin-githubpages/">こちら</a>を参考にした｡
それはよかったんだけど､<a href="https://github.com/JoelSutherland/GitHub-jQuery-Repo-Widget">GitHub jQuery Repo Widget</a>がGoogle Chromeで見てみると表示されず…なんでや…｡</p>

<div class="github-widget" data-repo="JoelSutherland/GitHub-jQuery-Repo-Widget"></div>

<p>早く世界中のブラウザがひとつになってほしい｡</p>

<h3 id="追記">追記</h3>

<p>これは<a href="http://qiita.com/futoase/items/39cb4b7d704b1e53e7f6">こういう</a>ことです｡</p>

<p>追記おわり</p>

<hr>

<p>シェル力極まってtmuxのステータスラインに表示するためのスクリプトとかも書きなおしてみたらパイプでつなぐなどするとワンライナーに収まったりして気持ちよかった(小並感)｡
またちまちまと書いているMoonScriptのSyntastic向けのチェッカも2倍速になった(元がひどすぎたのもある)｡</p>

<div class="github-widget" data-repo="Nymphium/syntastic-moonscript"></div>

<p>アイカツもいよいよ149話まで観たし本当に最高だった｡感極まって叫んだりして､同居していたインターン生のインディアン先輩には申し訳ないと思っている(おわり)｡</p>

          </div>
          <div class="pagination btn-group" style="text-align: center">
            <hr>
            <a class="btn prev" href="/2015/07/25/arch_install.html" title="ArchLinuxをインストールしました｡">&larr; Previous</a>
            &#47;<a class="btn" href="/">Top</a>&#47;
            <a class="btn next" href="/2015/11/23/beamertemplate.html" title="スライドを書いてると思ったらBeamerのテンプレートだけが肥大化した">Next &rarr;</a>
            <span style="padding-right: 4rem;"/>
          </div>
        </article>

      </div>
    </div>
  </body>
</html>
