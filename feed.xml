<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>lilyum ensemble</title>
    <description>lily, Aikatsu, Linux, Lua/MoonScript, and more</description>
    <link>http://nymphium.github.io/</link>
    <atom:link href="http://nymphium.github.io/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Thu, 08 Sep 2016 11:24:18 +0900</pubDate>
    <lastBuildDate>Thu, 08 Sep 2016 11:24:18 +0900</lastBuildDate>
    <generator>Jekyll v3.0.3</generator>
    
      <item>
        <title>『君の名は｡』考察</title>
        <description>&lt;h1 id=&quot;1-はじめに&quot;&gt;1. はじめに&lt;/h1&gt;

&lt;p&gt;『君の名は｡』存外に良かった､本当に良かったので考察したい｡
この映画に言及するためにはネタバレするしかしないので､ネタバレします｡&lt;/p&gt;

&lt;h1 id=&quot;2-流れ&quot;&gt;2. 流れ&lt;/h1&gt;

&lt;h2 id=&quot;2-1-視点&quot;&gt;2-1. 視点&lt;/h2&gt;

&lt;p&gt;｢映画観て即結婚｣｢映画の半券を見せるとラブホ代が安い｣などの超速報がありますが､これは&lt;strong&gt;&lt;em&gt;絵が綺麗なSF&lt;/em&gt;&lt;/strong&gt;ですよね｡そういう視点でした｡&lt;/p&gt;

&lt;p&gt;まずここから始めていきたい｡&lt;/p&gt;

&lt;h2 id=&quot;2-2-流れ&quot;&gt;2-2. 流れ&lt;/h2&gt;

&lt;p&gt;話の流れを確認すると､&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;👨👩｢ 入れ替わっちゃった〜〜???｣&lt;/li&gt;
&lt;li&gt;👩｢デートまでこぎつけたわw｣👨｢｣&lt;/li&gt;
&lt;li&gt;👨｢デートだめだったし電話繋がらんわ｣&lt;/li&gt;
&lt;li&gt;しばらく音信不通&lt;/li&gt;
&lt;li&gt;👨｢夢に出てきた場所? いったるわ｣&lt;/li&gt;
&lt;li&gt;👨｢完全に理解｣&lt;/li&gt;
&lt;li&gt;👨｢あの日の三葉になっちゃった!!!! 生きるぞ｣&lt;/li&gt;
&lt;li&gt;👨👩｢あ〜〜〜っ!!｣&lt;/li&gt;
&lt;li&gt;👩｢体戻りました完全理解｣&lt;/li&gt;
&lt;li&gt;救われた&lt;/li&gt;
&lt;li&gt;数年後&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;という感じですか｡&lt;/p&gt;

&lt;h1 id=&quot;3-人物について&quot;&gt;3. 人物について&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;三葉さん&lt;/p&gt;

&lt;p&gt;これが本作の主人公｡&lt;em&gt;神社の娘&lt;/em&gt;というのが大きなポイントです｡&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;滝くん&lt;/p&gt;

&lt;p&gt;これはただの男子高校生｡&lt;em&gt;建築系を目指してる&lt;/em&gt;点以外は普通だと思う｡&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;奥宮先輩&lt;/p&gt;

&lt;p&gt;滝くんのバイト先の先輩&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;克彦&lt;/p&gt;

&lt;p&gt;三葉さんの同級生｡テッシ｡&lt;em&gt;建築会社の息子&lt;/em&gt;というのが彼の重要な立ち位置｡&lt;/p&gt;

&lt;p&gt;序盤で｢主役は三葉｣などとメタ発言をしたり仕事をしたり極めて有能&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;早耶香&lt;/p&gt;

&lt;p&gt;三葉さんと男1の同級生｡とりあえず放送してくれる｡&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ラーメン屋のおっさん&lt;/p&gt;

&lt;p&gt;ラーメン屋のおっさん｡糸守出身だったり車を出してくれたりラーメンを提供してくれたり有能｡&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;4-考察&quot;&gt;4. 考察&lt;/h1&gt;

&lt;p&gt;話の序盤は入れ替わりに気づき､戸惑い､遊び､と非日常を楽しむ場面です｡
ぶっちゃけここはお楽しみパートで､&amp;quot;入れ替わり&amp;quot;という装置を用いたお遊びだと思います｡&lt;/p&gt;

&lt;p&gt;このなかで克彦くんは｢主役は三葉だもんな｣という発言をします｡これは神社でおこなわれる舞への言及ですが､主軸が三葉くんにあることの示唆とも思えます｡
舞では&lt;em&gt;三葉くんと四葉くんが口嚼ノ酒を生成&lt;/em&gt;します｡この酒が三葉さん達の&lt;em&gt;魂の半分&lt;/em&gt;である､というおばあちゃんの話は実は極めて重要なんですねぇ｡&lt;/p&gt;

&lt;p&gt;そして､奥宮先輩と滝くんのデートの失敗｡三葉さんに電話を入れたが繋がらず､日常パートがおわります｡
これは滝くんは奥宮先輩が好きだったが､&lt;em&gt;夢(夢ではない)の刷り込みにより三葉さんに想いが寄ってしまった&lt;/em&gt;のを奥宮先輩に見抜かれてデートが終わるんですねぇ｡
後述の&lt;strong&gt;宮水家の血筋&lt;/strong&gt;にこれは大きく関係するのではないかと考えられます｡&lt;/p&gt;

&lt;p&gt;一回しか観てないので記憶があやふやですが､このへんで宮水の御神体に口嚼ノ酒を奉納した気がします｡
概念として重要な&amp;quot;結び&amp;quot;の話をおばあちゃんがしてくれます｡また､おばあちゃん､一葉さんも過去に入れ替わりがあったことを示唆します｡
御神体が遠く､カルデラのような地形の中央にあるのも重要ですねぇ｡
選挙やってたパパも民俗学者だったという話はこのへん?&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;さて､視点は人格が三葉くんで体も同じくの三葉くんに戻ります｡
夏祭りの日｡彗星が最も近づく日｡&lt;/p&gt;

&lt;p&gt;ここでちょうど､滝くんの時間軸で3年前の10月4日に彗星のかけらが隕石となって糸守町を破壊するんですねぇ｡&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;思い立って夢で過ごした街に滝くん一行は行きます｡そして現実(過去)とつながります｡
街が破壊されるというのが個人的に好きなので､町がクレーターになって双子池になってるシーンに思わずニッコリしてしまいました｡
滝くんが描いた絵から糸守に気づいたり､滝くんを運んでくれたりとラーメン屋のおっさんは有能や｡&lt;/p&gt;

&lt;p&gt;ここで滝くんは､宮水の御神体の場所にならなにかあるかも､とひらめきます｡そして&lt;em&gt;三葉の魂の半分&lt;/em&gt;である口嚼ノ酒を飲みます｡
どちらが三葉くんのでどちらが四葉くんのというのは､自分が置いたんだからもちろん覚えているわけですな｡&lt;/p&gt;

&lt;p&gt;そしてすっ転んだ拍子に御神体のある祠の壁画に滝くんが気が付き､時間がぐにゃぐにゃになります｡
壁画には&lt;strong&gt;&lt;em&gt;過去の彗星の災害&lt;/em&gt;&lt;/strong&gt;が描かれているんですねぇ､エモい…｡
ここで明らかになる過去です｡
これまでの作中でも触れられたとおり､糸守にもともとあった湖は過去の､1200年前の隕石によるものです｡
そしてカルデラのような地形の中央に御神体があったことについて､これは更に前の隕石によるものかと思われます｡&lt;/p&gt;

&lt;p&gt;つまり､宮水家は&lt;strong&gt;&lt;em&gt;隕石による災害から市民を守るために生まれた家系&lt;/em&gt;&lt;/strong&gt;なんですねぇ｡&lt;/p&gt;

&lt;p&gt;そしてこの血筋の特徴は&lt;strong&gt;&lt;em&gt;入れ替わり&lt;/em&gt;&lt;/strong&gt;と&lt;strong&gt;&lt;em&gt;口嚼ノ酒&lt;/em&gt;&lt;/strong&gt;です｡&lt;/p&gt;

&lt;p&gt;前者､入れ替わりはつまり滝くんのような&lt;em&gt;糸守を助けてくれる人間の選択&lt;/em&gt;という役割を果たします｡
少なくとも隕石がやってくる代の巫女は未来から人間を引っ張ってくる必要がありそうですね｡
一葉さんもこの血筋の機能に無自覚だったように､三葉さんも無自覚なのでまずインシデントが起こる必要がある｡
そして起こってから､未来からの援護をしてもらう必要があると｡
いや〜でも夢(夢ではない)の刷り込みにより巫女のことを好きにさせちゃうってのは革命的だな〜〜!!
力強い寝取りだ｡&lt;/p&gt;

&lt;p&gt;この人選も適当な人間ではダメで､滝くんは建築を学んでいたため&amp;quot;夢&amp;quot;の景色を忠実に描画することができました｡
また三葉さんの父のキャラクターも｡おそらく三葉さんの母である二葉さんとの出会いはきっと彼女の&amp;quot;入れ替わり&amp;quot;によるものだったはずです｡
そして父氏は民俗学者｡1200年という周期は予想できないと思うので､毎代口嚼ノ酒を奉納していたはずです｡これを生成する舞は公開されていたので､父氏も知ったのでしょう｡
この特徴を民俗学者だからピンとくることができ､二葉さんに出会えたのでしょう｡町長? になって避難を最終的に助けたのも､二葉さんの(無意識の)人選の成果かもしれません｡&lt;/p&gt;

&lt;p&gt;そして後者､口嚼ノ酒はバックアップのようなものですね｡
選ばれた未来人､つまり滝くんとは10月4日を過ぎると巫女､つまり三葉さんと交信できなくなります｡隕石で死ぬので｡
そこで口嚼ノ酒なんですねぇ｡
魂の半分を未来人が飲むことで､未来人がすべて知った状態で過去に戻ってなんやかんやするわけですねぇ｡
極めて重要な装置です｡
水宮家が女系なのも､この酒の生成があるからだと思います｡神事でものをつくるといえば巫女! というわけですね｡
逆に男は&amp;quot;入れ替わり&amp;quot;で引っ張ってこれるからOKということ｡&lt;/p&gt;

&lt;p&gt;この血筋と水宮家の女性の名前についてですが､一葉さんから二､三､四とナンバリングされています｡
これはやはり､ナントカの大災害(忘れた)のせいで何かがズレたのかな､という考えがあります｡
そして四葉くんの存在については､三葉くんがトチった場合のスペアなんやろなぁ…という気持ちが湧いてきます｡&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;魂の半分を得て過去に戻ってきた滝くんの人格､三葉さんの身体は災害からみんなを守ろうと奔走します｡
テッシが有能なので町を一部破壊します｡有能ですね｡しかしどうしても限界がある｡そこで滝くんの人格は御神体に向かってみる｡
そして&amp;quot;かたわれどき&amp;quot;なんですねぇ｡お遊びパートとは言ったが意味はいくつか持っている｡
これは&amp;quot;魂の半分(かたわれ)を取り込んだ人間と逢える時間&amp;quot;､つまり巫女と未来人が逢える時間という意味なんだよな｡&lt;/p&gt;

&lt;p&gt;ところで災害を守るために神社を作る､というのは極めて日本的ですね｡やっぱ神社最高だな…｡&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;で､なんやかんやで全員無事ということで､未来､つまり滝くんの時間軸+数年後になる｡
奥宮先輩の薬指に指輪があるのがなんとも憎らしい演出ですね｡
そして最後に出会ってENDということで｡これは宮水の血が次世代に渡ったことの示唆でしょう｡&amp;quot;結び&amp;quot;ですね｡&lt;/p&gt;

&lt;h1 id=&quot;5-評価&quot;&gt;5. 評価&lt;/h1&gt;

&lt;p&gt;実は観る気は全然なくて､当日の未明に男数人で見に行こうということになったのでついて行った｡
観る気がない理由としては&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;異性愛&lt;/li&gt;
&lt;li&gt;RADWIMPS&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;充分ですね｡&lt;/p&gt;

&lt;p&gt;｢ま〜〜たいつもの異性LOVE新海作品か｣ということで劇場に足を運ぶ気は0で行った｡
しかもRADWIMPSは好きじゃないのでアレ｡&lt;/p&gt;

&lt;p&gt;なので観る前と観た後で評価が180度回転してしまったわけですなぁ｡
考察を書くほどに｡
&amp;quot;入れ替わり&amp;quot;についてTS界隈が盛り上がらないというのは､やはりこの&amp;quot;入れ替わり&amp;quot;自体は本質ではないですからね｡終盤は入れ替わらんし｡はい｡&lt;/p&gt;

&lt;p&gt;予告が恋愛を激プッシュしたのはなんとも巧妙ですね｡SFじゃねーか!!&lt;/p&gt;

&lt;p&gt;ただ伝えたかったことは弱いなと思いました｡
&amp;quot;RADのPV&amp;quot;という感想はまさにそれな気がします｡
伝えたかったことは薄いですが､作品そのものはメチャメチャに面白かったので､評価としては◎です｡&lt;/p&gt;

&lt;p&gt;一緒に観た､しっかり新海作品を予習してきた&lt;a href=&quot;https://twitter.com/ioriveur&quot;&gt;@ioriveur &lt;/a&gt;さん曰く
｢&lt;del&gt;新海誠の手癖はだいぶ克服した｡ただ新たな手癖ができてしまった&lt;/del&gt;新海誠の手癖は直ってないどころか新たな手癖がついた｣(本人により訂正されました)など言ってました｡ボクは新海作品観た記憶がほとんどないのでなんとも言えないですが｡&lt;/p&gt;

&lt;h1 id=&quot;6-おわりに&quot;&gt;6. おわりに&lt;/h1&gt;

&lt;p&gt;いやぁ本当に面白かったです｡
シンゴ･ジ･ラもなかなか面白かったですが､個人的にはシンゴよりも面白かったと思う｡
シンゴについて&amp;quot;恋愛要素がなくテンポがよかった&amp;quot;という評価をした人がいますが､今作品も恋愛要素によって妨げられる部分というのはなかった気がしますので､同じような評価ができるんじゃないかなと思います｡
&amp;quot;入れ替わり&amp;quot;による魂のペアリングは血による機能なので恋愛要素とは全然違うかなと｡&lt;/p&gt;

&lt;p&gt;でもこれSFって言っちゃうと即ネタバレになっちゃうんですよね｡
予告でもSF感を忍ばせていただけに｡だから感想は｢絵が綺麗だった｣くらいしか言えない｡
やっぱりなんでも観てみなきゃってことですね｡
次は『少女』と『スーサイド・スクワッド』と『怒り』と『HIGH &amp;amp; LOW』を観たいですねぇ｡&lt;/p&gt;

&lt;p&gt;おわり&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;考察をまとめたことがないので､考察ってこんなかんじで良いんですかね｡&lt;/p&gt;
</description>
        <pubDate>Wed, 07 Sep 2016 00:00:00 +0900</pubDate>
        <link>http://nymphium.github.io/2016/09/07/yourname.html</link>
        <guid isPermaLink="true">http://nymphium.github.io/2016/09/07/yourname.html</guid>
        
        <category>雑感</category>
        
        
      </item>
    
      <item>
        <title>うわ〜ん変わっちゃった〜〜! kindleのフォントが変わっちゃった〜! どうか､しましたか? kindleのフォントが変わってしまったのですが…｡</title>
        <description>&lt;h1 id=&quot;はじめに&quot;&gt;はじめに&lt;/h1&gt;

&lt;p&gt;Kindleの最安モデルがホコリをかぶっていたのですがなんとなくマウントしてみたところフォントの変更に成功した｡
こんなんググればいっぱい出てくると思うので今更書くまでもない話ですが､体験として面白かったので書いておく｡&lt;/p&gt;

&lt;h1 id=&quot;mount-ls&quot;&gt;mount, ls&lt;/h1&gt;

&lt;p&gt;USB接続すると､/dev/sdc1というものが生える｡
&lt;code&gt;lsblk -f&lt;/code&gt;とすると､どうやらvfatのようだ｡マウントする｡&lt;code&gt;ls&lt;/code&gt;を撃ち込むと､document､systemというディレクトリ､名前がハッシュのファイルなどがある｡&lt;/p&gt;

&lt;h1 id=&quot;怪しいsystem&quot;&gt;怪しいsystem&lt;/h1&gt;

&lt;p&gt;あきらかにsystemディレクトリに何かありそうだ｡&lt;em&gt;fonts&lt;/em&gt;というディレクトリがぶら下がっており､フォントを変えたい気持ちが突然わいてきた｡&lt;/p&gt;

&lt;h1 id=&quot;fonts&quot;&gt;fonts&lt;/h1&gt;

&lt;p&gt;中を見ると､&lt;em&gt;ja.font&lt;/em&gt;というファイルがある｡これやな｡&lt;/p&gt;

&lt;h1 id=&quot;cramfsやんけこれ&quot;&gt;cramfsやんけこれ&lt;/h1&gt;

&lt;p&gt;&lt;code&gt;xxd -g 1 ja.font | head&lt;/code&gt;してみると&lt;strong&gt;45 3d cd 28&lt;/strong&gt;というのが見える｡もちろん知らないのでググる｡Comressed ROMFSということが分かった｡
これもマウントしてみる｡
01-ja.confというfontconfigファイルとimage_manifestというフォント情報などが書かれたjsonファイルっぽいもの､ありましたねぇttfファイルが置かれているfontsディレクトリ｡&lt;/p&gt;

&lt;h1 id=&quot;read-onlyじゃんハゲ-コピーする&quot;&gt;read-onlyじゃんハゲ! コピーする&lt;/h1&gt;

&lt;p&gt;とのこと&lt;/p&gt;

&lt;h1 id=&quot;fontをつっこむ&quot;&gt;fontをつっこむ&lt;/h1&gt;

&lt;p&gt;好きなフォントを突っ込もう!! ライセンスを無視するのは :no_good:&lt;/p&gt;

&lt;p&gt;JSONに書かれた情報を更新する｡&lt;code&gt;&amp;quot;FONTFILE.ttf.md5&amp;quot;&lt;/code&gt;というパラメーターがあるので､&lt;code&gt;md5sum FONTFILE.ttf&lt;/code&gt;で得た値を差し込む｡
&lt;code&gt;&amp;quot;fonts.ja&amp;quot;&lt;/code&gt;には明朝体をローマ字で書く(のか?)｡&lt;code&gt;&amp;quot;font.MINCHOROMAN.display&amp;quot;&lt;/code&gt;パラメーターにはUTF-8でフォント名を埋め込みたい｡
ここでLua5.3の&lt;code&gt;utf8&lt;/code&gt;モジュールが役に立つわけですね! MoonScriptのリスト内包表記も便利だ!!&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-moon&quot; data-lang=&quot;moon&quot;&gt;&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;table.concat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;\\u%x&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;utf8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;codes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;FONT-NAME&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&quot;mkfs-cramfs&quot;&gt;mkfs.cramfs&lt;/h1&gt;

&lt;p&gt;コピーおよび変更したディレクトリをComressed ROMFSにもどす｡&lt;/p&gt;

&lt;h1 id=&quot;すっとする&quot;&gt;すっとする&lt;/h1&gt;

&lt;p&gt;Comressed ROMFSに戻したイメージファイルをja.fontとしてスッと戻す&lt;/p&gt;

&lt;h1 id=&quot;umount､確認&quot;&gt;umount､確認&lt;/h1&gt;

&lt;p&gt;ええな&lt;/p&gt;

&lt;h1 id=&quot;おわりに&quot;&gt;おわりに&lt;/h1&gt;

&lt;p&gt;買ってすぐ(2015年1月あたり)にフォントの変更を試み､ググってみたりはしたものの結局フォントの変更に至らなかったので､今回はよくやったと思いました｡
&lt;code&gt;file&lt;/code&gt;コマンドなどの使用をパッと思いつけばもう少し早くできましたね､反省してください｡&lt;/p&gt;
</description>
        <pubDate>Thu, 21 Jul 2016 00:00:00 +0900</pubDate>
        <link>http://nymphium.github.io/2016/07/21/kindle_font.html</link>
        <guid isPermaLink="true">http://nymphium.github.io/2016/07/21/kindle_font.html</guid>
        
        <category>Kindle</category>
        
        <category>雑感</category>
        
        
      </item>
    
      <item>
        <title>RAID0なF2FSにArchをインストールする</title>
        <description>&lt;p&gt;こんにちは､びしょ〜じょです｡女性が､自分の本当の気持ちに気づかずに男性に嫉妬するシーン最高ですね､本当に最高｡&lt;/p&gt;

&lt;h1 id=&quot;1-はじめに&quot;&gt;1. はじめに&lt;/h1&gt;

&lt;blockquote class=&quot;twitter-tweet&quot;&gt;&lt;p lang=&quot;ja&quot; dir=&quot;ltr&quot;&gt;体調も悪ければPCの体調も悪い &lt;a href=&quot;https://t.co/MRyWk50P81&quot;&gt;pic.twitter.com/MRyWk50P81&lt;/a&gt;&lt;/p&gt;&amp;mdash; びしょ～じょ (@Nymphium) &lt;a href=&quot;https://twitter.com/Nymphium/status/745232517612003330&quot;&gt;June 21, 2016&lt;/a&gt;&lt;/blockquote&gt;

&lt;script async src=&quot;//platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;blockquote class=&quot;twitter-tweet&quot;&gt;&lt;p lang=&quot;ja&quot; dir=&quot;ltr&quot;&gt;超コワすぎ！です。 &lt;a href=&quot;https://t.co/S62vq9GTfy&quot;&gt;pic.twitter.com/S62vq9GTfy&lt;/a&gt;&lt;/p&gt;&amp;mdash; びしょ～じょ (@Nymphium) &lt;a href=&quot;https://twitter.com/Nymphium/status/745977783994593281&quot;&gt;June 23, 2016&lt;/a&gt;&lt;/blockquote&gt;

&lt;script async src=&quot;//platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;blockquote class=&quot;twitter-tweet&quot;&gt;&lt;p lang=&quot;ja&quot; dir=&quot;ltr&quot;&gt;SSDが完全に死んで、死にました。&lt;/p&gt;&amp;mdash; びしょ～じょ (@Nymphium) &lt;a href=&quot;https://twitter.com/Nymphium/status/746677081539411968&quot;&gt;June 25, 2016&lt;/a&gt;&lt;/blockquote&gt;

&lt;script async src=&quot;//platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;p&gt;ところでSSDを買い換えました｡ArchInstallBattleです｡&lt;/p&gt;

&lt;h1 id=&quot;tl-dr&quot;&gt;TL; DR&lt;/h1&gt;

&lt;p&gt;ArchWiki嫁&lt;/p&gt;

&lt;h1 id=&quot;2-準備&quot;&gt;2. 準備&lt;/h1&gt;

&lt;h2 id=&quot;2-1-ストレージ&quot;&gt;2-1. ストレージ&lt;/h2&gt;

&lt;p&gt;まずSSDを換装します｡ThinkPad X1 CarbonなのでM.2 SSDですね｡いや〜こういうの買うとだいたい規格を間違えるんですよねぇこれ長いのと短いのがあって､でもまぁ流石にパソコン触って何年目だよってね&lt;/p&gt;

&lt;blockquote class=&quot;twitter-tweet&quot;&gt;&lt;p lang=&quot;ja&quot; dir=&quot;ltr&quot;&gt;パーフェクトゲーム &lt;a href=&quot;https://t.co/BYsmYwfdSM&quot;&gt;pic.twitter.com/BYsmYwfdSM&lt;/a&gt;&lt;/p&gt;&amp;mdash; びしょ～じょ (@Nymphium) &lt;a href=&quot;https://twitter.com/Nymphium/status/747008569107587073&quot;&gt;June 26, 2016&lt;/a&gt;&lt;/blockquote&gt;

&lt;script async src=&quot;//platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;h2 id=&quot;2-2-iso&quot;&gt;2-2. iso&lt;/h2&gt;

&lt;p&gt;Archの最新インストーラを引っ張ってUSBメモリに流し込む｡&lt;/p&gt;

&lt;h1 id=&quot;3-インストール&quot;&gt;3. インストール&lt;/h1&gt;

&lt;h2 id=&quot;3-1-partitioning&quot;&gt;3-1. partitioning&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;/&lt;/code&gt;と&lt;code&gt;/home&lt;/code&gt;を分けようかなと思いました｡でも同一ストレージ上で分けてもなんだか効果薄い気もしますが､まぁ気分が大事っつーわけよ｡
で､今回は&lt;a href=&quot;http://www.phoronix.com/scan.php?page=article&amp;amp;item=linux_raid_fs4&quot;&gt;RAID0にしてF2FSだな&lt;/a&gt;､という気持ちがふつふつと湧いてきた｡
BtrFSのようにRAID機能を提供してくれているわけではまったくないので､mdadmすっぞ｡
買ったのが256GBのSSDなので､&lt;code&gt;/&lt;/code&gt;に40G(× 2)､&lt;code&gt;/home&lt;/code&gt;に60G(× 2)､残り&lt;code&gt;/boot&lt;/code&gt;といった具合か｡&lt;/p&gt;

&lt;p&gt;ではインストールメディアを刺して起動して&lt;code&gt;/dev/sda&lt;/code&gt;かなんかを&lt;code&gt;cfdisk&lt;/code&gt;かなんかで分ける｡&lt;/p&gt;

&lt;p&gt;でパッといく｡&lt;code&gt;md0&lt;/code&gt;が&lt;code&gt;/&lt;/code&gt;で､&lt;code&gt;md1&lt;/code&gt;が&lt;code&gt;/home&lt;/code&gt;という感じ｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ mdadm --create /dev/md0 --level=0 --raid-devices=2 /dev/sdb1 /dev/sdb2
$ mdadm --create /dev/md1 --level=1 --raid-devices=2 /dev/sdb3 /dev/sdb4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;3-2-format&quot;&gt;3-2. format&lt;/h2&gt;

&lt;p&gt;でF2FSでガッといく｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ mkfs.f2fs /dev/md{0,1}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;3-3-mount&quot;&gt;3-3. mount&lt;/h2&gt;

&lt;p&gt;でスッと…｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ mount /dev/md0 /mnt
$ mkdir /mnt/{home,boot}
$ mount /dev/md1 /mnt/home
$ mount /dev/sdb5 /mnt/boot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;3-4-chrooting&quot;&gt;3-4. &lt;code&gt;chroot&lt;/code&gt;ing&lt;/h2&gt;

&lt;p&gt;で&lt;code&gt;pacstrap&lt;/code&gt;とかなんとかしてサーッといって&lt;code&gt;arch-chroot&lt;/code&gt;する｡以降はchroot下の話になるぽよ&lt;/p&gt;

&lt;p&gt;&lt;code&gt;f2fs-tools&lt;/code&gt;とか&lt;code&gt;refind-efi&lt;/code&gt;をヌッとやる必要がある｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$(chroot) pacman -S f2fs-tools refind-efi neovim
$(chroot) refind-install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;3-5-register-raid-device&quot;&gt;3-5. register raid device&lt;/h2&gt;

&lt;p&gt;ひとまず登録&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$(chroot) mdadm --detail --scan &amp;gt; /etc/mdadm.conf
$(chroot) mdadm --assemble --scan
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;3-6-mkinitcpio&quot;&gt;3-6. mkinitcpio&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;/etc/mkinitcpio.conf&lt;/code&gt;をいじる必要があるんやな｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-config&quot; data-lang=&quot;config&quot;&gt;......
&lt;span class=&quot;n&quot;&gt;MODULES&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;...... f2fs crc32_generic crc32-pclmul&quot;&lt;/span&gt;
......
&lt;span class=&quot;n&quot;&gt;BINARIES&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;fsck fsck.f2fs&quot;&lt;/span&gt;
......
&lt;span class=&quot;n&quot;&gt;HOOKS&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;...... mdadm_udev .....&quot;&lt;/span&gt;
......
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;3-7-refind&quot;&gt;3-7. refind&lt;/h2&gt;

&lt;p&gt;あと&lt;code&gt;/boot/redind_linux.conf&lt;/code&gt;をいじる｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;&quot;Boot with standard option&quot; &quot;ro root=/dev/md0 md=0,/dev/sda1,/dev/sda2 md=1,/dev/sda3,/dev/sda4&quot;
&quot;Boot to single-user mode&quot; &quot;ro root=/dev/md0 md=0,/dev/sda1,/dev/sda2 md=1,/dev/sda3,/dev/sda4 single&quot;
&quot;Boot with minimal options&quot; &quot;ro root=/dev/md0 md=0,/dev/sda1,/dev/sda2 md=1,/dev/sda3,/dev/sda4&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ちょっとださいですね､パーティションラベルで指定する方法もあるそうですが､うーん｡&lt;/p&gt;

&lt;p&gt;さて&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$(chroot) mkinitcpio -p linux
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;chroot抜けてあれしてこれしておわり&lt;/p&gt;

&lt;p&gt;俺はちゃんと起動した｡お前はどうだ?&lt;/p&gt;

&lt;h1 id=&quot;4-おわりに&quot;&gt;4. おわりに&lt;/h1&gt;

&lt;p&gt;fstabに&lt;a href=&quot;https://www.kernel.org/doc/Documentation/filesystems/f2fs.txt&quot;&gt;オプション&lt;/a&gt;をいろいろ突っ込んで爆上げや｡&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;今週は期末試験100連発です｡&lt;/p&gt;
</description>
        <pubDate>Sun, 26 Jun 2016 00:00:00 +0900</pubDate>
        <link>http://nymphium.github.io/2016/06/26/RAID0%E3%81%AAF2FS%E3%81%ABArch%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B.html</link>
        <guid isPermaLink="true">http://nymphium.github.io/2016/06/26/RAID0%E3%81%AAF2FS%E3%81%ABArch%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B.html</guid>
        
        <category>Linux</category>
        
        <category>Arch</category>
        
        
      </item>
    
      <item>
        <title>Lua5.2から5.3への内部表現について💢</title>
        <description>&lt;p&gt;こんにちは､びしょ〜じょです｡極めて眠いホトトギス&lt;/p&gt;

&lt;h1 id=&quot;1-はじめに&quot;&gt;1. はじめに&lt;/h1&gt;

&lt;p&gt;Lua5.2のVMのバイトコードをデコードする物体を用いて､Lua5.3のVMのバイトコードをデコードしようとしたら結構つまづきました｡という話｡
Luaはわりと､関数が減っただ増えただ程度の変更しか無く､互換性は高いかのように見えますが､内部ではガッツリ変わってるんですねぇここ2ヶ月で思い知らされました｡&lt;/p&gt;

&lt;h1 id=&quot;2-internal-constant-expression&quot;&gt;2. internal constant expression&lt;/h1&gt;

&lt;p&gt;luaファイルを&lt;code&gt;luac&lt;/code&gt;でコンパイルすると&lt;em&gt;luac.out&lt;/em&gt;というファイルが得られます｡&lt;/p&gt;

&lt;p&gt;ところで&lt;code&gt;&amp;quot;hoge&amp;quot;&lt;/code&gt;とか&lt;code&gt;3&lt;/code&gt;などの定数はluac.outのfunction blockのconstants listという部分に､コード中での出現順に格納されます｡
もう少し解説すると､constants listは以下のような構造になっている｡&lt;/p&gt;

&lt;p&gt;\[
[格納されている定数の数(4\mathsf{byte})][定数[種類(1\mathsf{byte}) 種類別(n\ \mathsf{byte})]...]
\]&lt;/p&gt;

&lt;p&gt;この種類がクセモノなんですねぇ…｡&lt;/p&gt;

&lt;h1 id=&quot;3-型が増えた-integer-long-string&quot;&gt;3. 型が増えた? integer, long string&lt;/h1&gt;

&lt;p&gt;まずこの種類について見ていきます｡constants listに現れる種類は以下のようになります｡&lt;/p&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;type&lt;/th&gt;
&lt;th style=&quot;text-align: right&quot;&gt;value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;nil&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;00&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;bool&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;01&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;number&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;03&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;string&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;04&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;次のようなコードを考える｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;c1&quot;&gt;-- hoge.lua&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;aaaaaaaa...aaaa&quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- 256文字以上で適当に､ここでは256文字とする&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;3-1-until-lua-5-2&quot;&gt;3-1. until Lua 5.2&lt;/h2&gt;

&lt;p&gt;まずLua5.2でコンパイルしてバイトコードを見てみる｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ luac5.2  hoge.lua
$ xxd -g 1 luac.out
00000000: 1b 4c 75 61 52 00 01 04 08 04 08 00 19 93 0d 0a  .LuaR...........
00000010: 1a 0a 00 00 00 00 00 00 00 00 00 01 03 04 00 00  ................
00000020: 00 01 00 00 00 41 40 00 00 81 80 00 00 1f 00 80  .....A@.........
00000030: 00 03 00 00 00 04 01 01 00 00 00 00 00 00 61 61  ..............aa
00000040: 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61  aaaaaaaaaaaaaaaa
......
00000130: 61 61 61 61 61 61 61 61 61 61 61 61 61 61 00 03  aaaaaaaaaaaaaa..
00000140: 00 00 00 00 00 00 08 40 03 00 00 00 00 00 00 10  .......@........
00000150: 40 00 00 00 00 01 00 00 00 01 00 0a 00 00 00 00  @...............
......
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ヘッダがあり､(中略)､0x00000031からconstants listです｡
ちなみにヘッダからリトルエンディアンであることがわかるので､最初の&lt;code&gt;03 00 00 00&lt;/code&gt;はつまり&amp;quot;3&amp;quot;､定数の数です｡一致していますね｡&lt;/p&gt;

&lt;p&gt;次に定数が3つ出現順に見えますはい｡ここから本題なんやな｡&lt;/p&gt;

&lt;h3 id=&quot;3-1-1-string-a&quot;&gt;3-1-1. string &lt;code&gt;a&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;まず1byte､種類がみえてくるわけですが&lt;code&gt;04&lt;/code&gt;ということはつまりstring､これはつまり変数&lt;code&gt;a&lt;/code&gt;に格納される定数&lt;code&gt;&amp;quot;aaaaaa....aa&amp;quot;&lt;/code&gt;ですね｡
次の8byteは実は文字列の長さなんですねぇ､はい｡&lt;code&gt;01 01 00 00 00 00 00 00&lt;/code&gt;ということで､リトルエンディアンで解釈すると257文字ですか､この+1は&lt;code&gt;\0&lt;/code&gt;ですねわかります｡
さて257byteみていくと､たしかに0x61が256個並んで最後に0x00があります｡いいですね｡ここまでで0x0000013eまで読みました｡&lt;/p&gt;

&lt;h3 id=&quot;3-1-2-number-b-c&quot;&gt;3-1-2. number &lt;code&gt;b&lt;/code&gt;, &lt;code&gt;c&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;さて続きまして1byte見ると&lt;code&gt;03&lt;/code&gt;ということで､numberですか｡8byte読んでみてください｡はい&lt;code&gt;00 00 00 00 00 00 08 40&lt;/code&gt;ということですがまずこれをIEEE 754 単精度浮動小数点数にするんやな…｡
ではこちらをご覧ください｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decodenum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mantissa&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;mantissa&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mantissa&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;256&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exponent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;128&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exponent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;mantissa&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;math.ldexp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mantissa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;52&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;127&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;math.ldexp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mantissa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exponent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1023&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ieee754&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;string.char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x08&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x40&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decodenum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ieee754&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;--&amp;gt; 3.0&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;はい､&lt;code&gt;3.0&lt;/code&gt;ということで､&lt;code&gt;b&lt;/code&gt;ですね｡OK｡0x00000147まで読みました｡&lt;/p&gt;

&lt;p&gt;同様にして次は&lt;code&gt;4.0&lt;/code&gt;ですねはい論破&lt;/p&gt;

&lt;h2 id=&quot;3-2-lua-5-3&quot;&gt;3-2. Lua 5.3&lt;/h2&gt;

&lt;p&gt;いやいや内部表現変わらんでしょ→死&lt;/p&gt;

&lt;p&gt;ではコンパイルしてみる｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ luac5.3 hoge.lua
$ xxd -g 1 luac.out
00000000: 1b 4c 75 61 53 00 19 93 0d 0a 1a 0a 04 08 04 08  .LuaS...........
00000010: 08 78 56 00 00 00 00 00 00 00 00 00 00 00 28 77  .xV...........(w
00000020: 40 01 0a 40 68 6f 67 65 2e 6c 75 61 00 00 00 00  @..@hoge.lua....
00000030: 00 00 00 00 00 02 03 04 00 00 00 01 00 00 00 41  ...............A
00000040: 40 00 00 81 80 00 00 26 00 80 00 03 00 00 00 14  @......&amp;amp;........
00000050: ff 01 01 00 00 00 00 00 00 61 61 61 61 61 61 61  .........aaaaaaa
00000060: 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61  aaaaaaaaaaaaaaaa
......
00000150: 61 61 61 61 61 61 61 61 61 03 00 00 00 00 00 00  aaaaaaaaa.......
00000160: 08 40 13 04 00 00 00 00 00 00 00 01 00 00 00 01  .@..............
......
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ウーン､そうですか…｡0x0000004bからconstants listが始まり､&lt;code&gt;03 00 00 00&lt;/code&gt;からconstantは3つということがわかるんですが…｡&lt;/p&gt;

&lt;h3 id=&quot;3-2-1-long-string-←は&quot;&gt;3-2-1. long string ←は?&lt;/h3&gt;

&lt;p&gt;1byte読みすすめると早速0x14という謎の種類が爆誕するんですねぇ実はコレLua5.3から追加されたlong stringですが内部表現のみに現れるので皆さん安心してください｡&lt;/p&gt;

&lt;p&gt;さらに進めてみると&lt;code&gt;ff 01 01 00 00 00 00 00 00 61 61 61 61 61 ......&lt;/code&gt;というよくわからない感じになってますね｡
0x61は&amp;#39;a&amp;#39;だというのはわかる｡その前の&lt;code&gt;ff 01 01 00 00 00 00 00 00&lt;/code&gt;はおそらく文字列の長さなんですが､なんだこれは｡
256文字なので､0x0100か&amp;#39;\0&amp;#39;を追加した0x0101という表現がどこかにあるはずで､ありますね &lt;code&gt;01 01 00 00 00 00 00 00&lt;/code&gt;｡
頭の&lt;code&gt;ff&lt;/code&gt;は変わらないんで､&lt;code&gt;14 ff&lt;/code&gt;がobject typeだと思っていいんじゃないでしょうか｡
で､0x100文字で&lt;code&gt;a&lt;/code&gt;が出土したと｡ポイントは､&amp;#39;\0&amp;#39;はいらなくなったので&lt;code&gt;0x101 - 1&lt;/code&gt; ですね｡&lt;/p&gt;

&lt;p&gt;ネタバレをいうと､255文字以下はLua 5.2までと同じです｡0xff文字以下とそれより上を別のオブジェクトとすることで､何か良いことがあるんですかねぇ謎｡&lt;/p&gt;

&lt;h3 id=&quot;3-2-2-integer-←は&quot;&gt;3-2-2. integer ←は?&lt;/h3&gt;

&lt;p&gt;まぁええわ｡次は&lt;code&gt;b&lt;/code&gt;ですね〜ハイハイ同じ感じで&lt;code&gt;03 00 00 00 00 00 00 08 40&lt;/code&gt;ですね終わり｡この時点で0x00000161まで読みました｡&lt;/p&gt;

&lt;p&gt;次に&lt;code&gt;13&lt;/code&gt;というのが来て､民衆は困惑するんですねぇ…｡と思ったけどじつはだいぶ素直で､8byte読んでみると&lt;code&gt;04 00 00 00 00 00 00 00&lt;/code&gt;でこれはリトルエンディアンで読むとたちどころに&lt;code&gt;4&lt;/code&gt;であることが分かってしまう｡&lt;/p&gt;

&lt;p&gt;&lt;em&gt;まさにintegerって感じですね!&lt;/em&gt; Lua 5.3からbitwise operation(&lt;code&gt;&amp;amp;&lt;/code&gt;, &lt;code&gt;|&lt;/code&gt;, &lt;code&gt;&amp;lt;&amp;lt;&lt;/code&gt;, &lt;code&gt;&amp;gt;&amp;gt;&lt;/code&gt;, &lt;code&gt;bit32&lt;/code&gt;モジュール)が追加されたので､これを速く動かしたいという狙いなのかもしれない｡ちなみにsigned integerなので0x7fffffffffffffff(16桁)がINT_MAXッシュ&lt;/p&gt;

&lt;h3 id=&quot;3-2-3-lua-5-3での内部のオブジェクトの種類&quot;&gt;3-2-3. Lua 5.3での内部のオブジェクトの種類&lt;/h3&gt;

&lt;p&gt;つまりこう｡&lt;/p&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;type&lt;/th&gt;
&lt;th style=&quot;text-align: right&quot;&gt;value&lt;/th&gt;
&lt;th style=&quot;text-align: left&quot;&gt;備考&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;nil&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;00&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;bool&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;01&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;number&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;03&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;64bit float&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;integer&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;13&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;64bit signed int&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;string&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;04&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;長さ255以下の文字列&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;long string&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;14&lt;/td&gt;
&lt;td style=&quot;text-align: left&quot;&gt;長さ256以上の文字列&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;nilとboolってさぁ…&lt;code&gt;LOADNIL&lt;/code&gt;命令と&lt;code&gt;LOADBOOL&lt;/code&gt;命令があるんだから定数としてなんていらないんだよなぁ…｡&lt;/p&gt;

&lt;h1 id=&quot;4-ベンチマーク&quot;&gt;4. ベンチマーク&lt;/h1&gt;

&lt;p&gt;long stringはどれくらい活きるのか､integerは､ファイッ&lt;/p&gt;

&lt;h2 id=&quot;4-1-環境&quot;&gt;4-1. 環境&lt;/h2&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: right&quot;&gt;key&lt;/th&gt;
&lt;th&gt;value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: right&quot;&gt;CPU&lt;/td&gt;
&lt;td&gt;Intel(R) Core(TM) i5-5200U CPU @ 2.20GHz&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: right&quot;&gt;OS&lt;/td&gt;
&lt;td&gt;Arch Linux 4.6.2-1-ARCH&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;処理系はLua 5.2.5､5.3.3を使用&lt;/p&gt;

&lt;h2 id=&quot;4-2-prerequirement&quot;&gt;4-2. Prerequirement&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ luarocls --local install luasock
$ luarocls-5.2 --local install luasock
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;こんなファイルを用意&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;cm&quot;&gt;--[[
testsuite.lua
]]&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sock&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;socket&#39;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;REP&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;500000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- 感謝の5億回ループ&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;-- 関数fnの実行時間を測る&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;get_exectime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gettime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gettime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;4-3-long-string&quot;&gt;4-3. long string&lt;/h2&gt;

&lt;p&gt;次のようなものを考える｡メモリの確保･開放を見る｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;setmetatable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;testsuite&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__index&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_exectime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;REP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;こういうときbashが便利なんですよ〜〜&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0;i&amp;lt;10;i++&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  lua alloc.lua;
  sleep 3
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; | awk &lt;span class=&quot;s1&quot;&gt;&#39;{i+= $1}END{print i / 10.00}&#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;version&lt;/th&gt;
&lt;th style=&quot;text-align: right&quot;&gt;time(sec)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.2&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;5.25221&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.3&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;3.72571&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;setmetatable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;testsuite&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__index&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_exectime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- &amp;lt; 256&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;REP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;upper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;version&lt;/th&gt;
&lt;th style=&quot;text-align: right&quot;&gt;time(sec)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.2&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;67.8894&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.3&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;68.0755&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;long stringを見る｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;setmetatable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;testsuite&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__index&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_exectime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;REP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;aaaaaaaaaaa......aaaaa&quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- 256文字&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;version&lt;/th&gt;
&lt;th style=&quot;text-align: right&quot;&gt;time(sec)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.2&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;5.25645&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.3&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;3.72407&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;setmetatable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;testsuite&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__index&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_exectime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;aaaaaaaaaaa......aaaaa&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;REP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;upper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;version&lt;/th&gt;
&lt;th style=&quot;text-align: right&quot;&gt;time(sec)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.2&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;224.461&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.3&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;217.083&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;あんまおもんないですね｡&lt;/p&gt;

&lt;p&gt;とりあえずtableのkeyにつっこむか｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;setmetatable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;testsuite&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__index&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_exectime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;aaaaaaaaaaa......aaaaa&quot;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;REP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;version&lt;/th&gt;
&lt;th style=&quot;text-align: right&quot;&gt;time(sec)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.2&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;13.2316&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.3&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;13.4676&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;あんまおもんないですね｡&lt;/p&gt;

&lt;h2 id=&quot;4-4-integer-number&quot;&gt;4-4. integer/number&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;setmetatable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;testsuite&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__index&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_exectime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;REP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;version&lt;/th&gt;
&lt;th style=&quot;text-align: right&quot;&gt;time(sec)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.2&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;5.53783&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.3&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;3.91654&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;おもむろにtableのkeyにつっこんでみます｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;setmetatable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;testsuite&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__index&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_exectime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- number&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;REP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;version&lt;/th&gt;
&lt;th style=&quot;text-align: right&quot;&gt;time(sec)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.2&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;9.43846&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.3&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;9.59013&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;はい｡&lt;/p&gt;

&lt;p&gt;ではinteger vs numberではドウカナ…&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;setmetatable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;testsuite&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__index&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_exectime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- integer&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;REP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;version&lt;/th&gt;
&lt;th style=&quot;text-align: right&quot;&gt;time(sec)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.2&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;9.13759&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.3&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;6.32312&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;ｲｲﾈ･&lt;/p&gt;

&lt;p&gt;ところで! ところでですよ奥さん｡Lua 5.3には&lt;code&gt;math.tointeger()&lt;/code&gt;という関数が追加されて､機能は名前の通りです｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;setmetatable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;testsuite&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__index&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ENV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_exectime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numi&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;math&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tointeger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;REP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;numi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;てな感じでnumberからintegerに変換すると､&lt;/p&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: left&quot;&gt;version&lt;/th&gt;
&lt;th style=&quot;text-align: right&quot;&gt;time(sec)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.2&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;---&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: left&quot;&gt;5.3&lt;/td&gt;
&lt;td style=&quot;text-align: right&quot;&gt;6.38205&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;という具合ですね｡&lt;/p&gt;

&lt;h2 id=&quot;4-5-さらなる詳細&quot;&gt;4-5. さらなる詳細&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;grep -rE &amp;#39;LUA_(TNUMINT|TLNGSTR)&amp;#39; lua-5.3.3/src&lt;/code&gt; してください(飽きた)｡&lt;/p&gt;

&lt;h1 id=&quot;5-おわりに&quot;&gt;5. おわりに&lt;/h1&gt;

&lt;p&gt;stringは何も変わらなくてつまらない感じでしたが､integer型はtableのindexingでそこそこの性能がありますね｡
ボクはbytecodeの解析時にLua 5.2のノリで5.3をやったら突然の種類追加につまづいたので､みなさんもつまづいてください｡&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;このサイトのCSSやら何やらをいじって可愛い感じになったので､可愛い気持ちになってください｡&lt;/p&gt;
</description>
        <pubDate>Fri, 17 Jun 2016 00:00:00 +0900</pubDate>
        <link>http://nymphium.github.io/2016/06/17/luaexpression.html</link>
        <guid isPermaLink="true">http://nymphium.github.io/2016/06/17/luaexpression.html</guid>
        
        <category>Lua</category>
        
        
      </item>
    
      <item>
        <title>今日はSB69の日</title>
        <description>&lt;blockquote class=&quot;twitter-tweet&quot;&gt;&lt;p lang=&quot;ja&quot; dir=&quot;ltr&quot;&gt;今日SB69の一挙放送上映会に行く気まんまんでというか当選したので行けるんですが､チケットがないことにいまさら気づいておかしいなぁと思ったらチケットの発送予定日過ぎてて､支払いはクレカだと思ってたんですがそもそもクレカ登録してないじゃん(完)｡&lt;/p&gt;&amp;mdash; びしょ～じょ (@Nymphium) &lt;a href=&quot;https://twitter.com/Nymphium/status/741375102122479616&quot;&gt;June 10, 2016&lt;/a&gt;&lt;/blockquote&gt;

&lt;script async src=&quot;//platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;blockquote class=&quot;twitter-tweet&quot;&gt;&lt;p lang=&quot;ja&quot; dir=&quot;ltr&quot;&gt;土曜日､終了です｡&lt;/p&gt;&amp;mdash; びしょ～じょ (@Nymphium) &lt;a href=&quot;https://twitter.com/Nymphium/status/741375169373966336&quot;&gt;June 10, 2016&lt;/a&gt;&lt;/blockquote&gt;

&lt;script async src=&quot;//platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;blockquote class=&quot;twitter-tweet&quot;&gt;&lt;p lang=&quot;ja&quot; dir=&quot;ltr&quot;&gt;そりゃ単位も3年で80個落としますわ…｡&lt;/p&gt;&amp;mdash; びしょ～じょ (@Nymphium) &lt;a href=&quot;https://twitter.com/Nymphium/status/741376021430030336&quot;&gt;June 10, 2016&lt;/a&gt;&lt;/blockquote&gt;

&lt;script async src=&quot;//platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;blockquote class=&quot;twitter-tweet&quot;&gt;&lt;p lang=&quot;ja&quot; dir=&quot;ltr&quot;&gt;流石に80は話を盛りすぎたと思って確認したら85でした｡ありがとございました｡&lt;/p&gt;&amp;mdash; びしょ～じょ (@Nymphium) &lt;a href=&quot;https://twitter.com/Nymphium/status/741376512943759360&quot;&gt;June 10, 2016&lt;/a&gt;&lt;/blockquote&gt;

&lt;script async src=&quot;//platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;p&gt;今日はSB69の日､二度とこの悲劇を産んではいけない｡&lt;/p&gt;
</description>
        <pubDate>Sat, 11 Jun 2016 00:00:00 +0900</pubDate>
        <link>http://nymphium.github.io/2016/06/11/%E4%BB%8A%E6%97%A5%E3%81%AFSB69%E3%81%AE%E6%97%A5.html</link>
        <guid isPermaLink="true">http://nymphium.github.io/2016/06/11/%E4%BB%8A%E6%97%A5%E3%81%AFSB69%E3%81%AE%E6%97%A5.html</guid>
        
        <category>雑感</category>
        
        
      </item>
    
      <item>
        <title>Lua 5.3.3 release - 変更に&quot;python rule&quot;とありますが -</title>
        <description>&lt;p&gt;こんにちは､びしょ〜じょです｡イベントに複数行ったらお金がなくなりました｡&lt;/p&gt;

&lt;hr&gt;

&lt;h1 id=&quot;1-はじめに&quot;&gt;1. はじめに&lt;/h1&gt;

&lt;p&gt;Lua 5.3.3がリリースされました｡&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.lua.org/work/diffu-lua-5.3.2-lua-5.3.3.html&quot;&gt;diffu-lua-5.3.2-lua-5.3.3&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;5.3.2からのアップデートなのでbug fix &lt;em&gt;だけ&lt;/em&gt; かと思いきや…｡&lt;/p&gt;

&lt;h1 id=&quot;2-new-semantics-for-empty-matches-quot-python-rule-quot&quot;&gt;2. new semantics for empty matches (&amp;quot;python rule&amp;quot;)&lt;/h1&gt;

&lt;p&gt;Lua 5.3.3-rc1のリリースではこんな感じのことが書かれてました｡&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://lua-users.org/lists/lua-l/2016-05/msg00068.html&quot;&gt;Re&amp;#58; &amp;#91;ANN&amp;#93; Lua 5.3.3 &amp;#40;rc1&amp;#41; now available&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;new semantics for empty matches (&amp;quot;Python rule&amp;quot;)&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;なるほど｡ところで以下のようなコードを考える｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;a,,b,c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gmatch&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;[^,]*&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Lua5.3.2までは以下のようになる｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ lua
Lua 5.3.2  Copyright (C) 1994-2015 Lua.org, PUC-Rio
&amp;gt; for k in (&quot;a,,b,c&quot;):gmatch&quot;[^,]*&quot; do
&amp;gt;   print(k)
&amp;gt; end
a


b

c

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;さて､&amp;quot;python rule&amp;quot;なLua 5.3.3では｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ lua533
Lua 5.3.3  Copyright (C) 1994-2016 Lua.org, PUC-Rio
&amp;gt; for k in (&quot;a,,b,c&quot;):gmatch&quot;[^,]*&quot; do
&amp;gt;   print(k)
&amp;gt; end
a

b
c
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;文字通り､Lua 5.3.3ではempty matchにpython ruleを適用しているようですね｡&lt;/p&gt;

&lt;h1 id=&quot;3-python-rule-is-何&quot;&gt;3. python rule is 何&lt;/h1&gt;

&lt;p&gt;Pythonに明るくないので､python ruleがよくわからなかった｡検索してみても出てこなかったので､まぁ､&amp;quot;empty matchはPythonでのように扱われる&amp;quot;という話です｡&lt;/p&gt;

&lt;p&gt;いやPython知らんのでどうなるか分からんのだが｡&lt;/p&gt;

&lt;h2 id=&quot;3-1-case1-gmatch&quot;&gt;3-1. case1: gmatch&lt;/h2&gt;

&lt;p&gt;ということで上記を見てみます｡
&lt;code&gt;&amp;quot;a,,b,c&amp;quot;&lt;/code&gt;に&lt;code&gt;gmatch()&lt;/code&gt;で&lt;code&gt;&amp;quot;[^,]*&amp;quot;&lt;/code&gt;にマッチする文字列を次々取り出すファクトリー(イテレーター)となり､&lt;code&gt;k&lt;/code&gt;に値を渡して出力していく｡&lt;/p&gt;

&lt;h3 id=&quot;3-1-1-before-533&quot;&gt;3-1-1. before 533&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;&amp;quot;a,,b,c&amp;quot;&lt;/code&gt;を見ていき､&lt;code&gt;&amp;quot;a&amp;quot;&lt;/code&gt;にマッチし､出力します｡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;quot;,,b,c&amp;quot;&lt;/code&gt;を見ていき､マッチしないので&lt;em&gt;&lt;code&gt;k&lt;/code&gt;に&lt;code&gt;&amp;quot;&amp;quot;&lt;/code&gt;を渡し&lt;/em&gt;､長さ0の文字列を出力します｡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;quot;,b,c&amp;quot;&lt;/code&gt;を見ていき､同上&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;quot;b,c&amp;quot;&lt;/code&gt;を見ていき､&lt;code&gt;&amp;quot;b&amp;quot;&lt;/code&gt;にマッチするので略&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;quot;,c&amp;quot;&lt;/code&gt;を見ていき､0 length&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;quot;c&amp;quot;&lt;/code&gt;を見ていき略&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;quot;&amp;quot;&lt;/code&gt;を見ていき､マッチしないので0len出力&lt;/li&gt;
&lt;li&gt;ファクトリーが全てを消費したので&lt;code&gt;for&lt;/code&gt;ループが終了｡&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;3-1-2-after-533&quot;&gt;3-1-2. after 533&lt;/h3&gt;

&lt;p&gt;操作自体は同じだが…｡&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;&amp;quot;a,,b,c&amp;quot;&lt;/code&gt;を見ていき､&lt;code&gt;&amp;quot;a&amp;quot;&lt;/code&gt;にマッチし､出力｡&lt;/li&gt;
&lt;li&gt;(?) &lt;code&gt;&amp;quot;,,b,c&amp;quot;&lt;/code&gt;を見ていき､&lt;code&gt;&amp;quot;&amp;quot;&lt;/code&gt;を出力?&lt;/li&gt;
&lt;li&gt;(?) &lt;code&gt;&amp;quot;,b,c&amp;quot;&lt;/code&gt;を見ていき何もしない?&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;quot;b,c&amp;quot;&lt;/code&gt;を見ていき､&lt;code&gt;&amp;quot;b&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;(?) &lt;code&gt;&amp;quot;,c&amp;quot;&lt;/code&gt;を見ていき､マッチしないので何もしない…?&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;quot;c&amp;quot;&lt;/code&gt;を見ていき､&lt;code&gt;&amp;quot;c&amp;quot;&lt;/code&gt;を出力&lt;/li&gt;
&lt;li&gt;(?) &lt;code&gt;&amp;quot;&amp;quot;&lt;/code&gt; を見ていき…??&lt;/li&gt;
&lt;li&gt;&lt;code&gt;for&lt;/code&gt;終了&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;よくわからないですね!!&lt;/em&gt;&lt;/strong&gt; もすうこし見てみます｡&lt;/p&gt;

&lt;h2 id=&quot;3-2-case2-gsub&quot;&gt;3-2. case2: gsub&lt;/h2&gt;

&lt;p&gt;置換してみます｡こんな感じ｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;a12b3c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gsub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;[^0-9]*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;X&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;3-2-1-before-533&quot;&gt;3-2-1. before 533&lt;/h3&gt;

&lt;p&gt;まず､以下の結果が得られる｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ lua
Lua 5.3.2  Copyright (C) 1994-2015 Lua.org, PUC-Rio
&amp;gt; print((&quot;a12b3c&quot;):gsub(&quot;[^0-9]*&quot;, &quot;X&quot;))
XX1X2XX3XX      7
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;3-2-2-after-533&quot;&gt;3-2-2. after 533&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ lua533
Lua 5.3.3  Copyright (C) 1994-2016 Lua.org, PUC-Rio
&amp;gt; print((&quot;a12b3c&quot;):gsub(&quot;[^0-9]*&quot;, &quot;X&quot;))
X1X2X3X 4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;どちらも &lt;strong&gt;&lt;em&gt;よくわからないですね!!&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;h1 id=&quot;4-おわりに&quot;&gt;4. おわりに&lt;/h1&gt;

&lt;p&gt;メーリングリストでもこの変更に関しては&amp;quot;Lua 5.4でやれ&amp;quot;という意見もあったんですがリリースしてしまいましたね｡
みなさん気をつけてください｡ボクは今月お金がないので食費に気をつけます｡&lt;/p&gt;
</description>
        <pubDate>Tue, 07 Jun 2016 00:00:00 +0900</pubDate>
        <link>http://nymphium.github.io/2016/06/07/lua533.html</link>
        <guid isPermaLink="true">http://nymphium.github.io/2016/06/07/lua533.html</guid>
        
        <category>Lua</category>
        
        
      </item>
    
      <item>
        <title>Luaのtableについて</title>
        <description>&lt;p&gt;こんにちは､びしょ〜じょです｡
&lt;a href=&quot;http://www.aikatsu.com/goods/magazine/top_of_works/&quot;&gt;アイカツ! Top of works&lt;/a&gt;はぶっちゃけヤバイ｡幸せがグッと詰まってるのでぜひ買ってください｡
でかいので買う前にスペース確保などしてください｡&lt;/p&gt;

&lt;blockquote class=&quot;twitter-tweet&quot;&gt;&lt;p lang=&quot;ja&quot; dir=&quot;ltr&quot;&gt;縦幅が2.2TAPLある。 &lt;a href=&quot;https://t.co/Pk4b1QugEX&quot;&gt;pic.twitter.com/Pk4b1QugEX&lt;/a&gt;&lt;/p&gt;&amp;mdash; びしょ～じょ (@Nymphium) &lt;a href=&quot;https://twitter.com/Nymphium/status/732109386462584832&quot;&gt;May 16, 2016&lt;/a&gt;&lt;/blockquote&gt;

&lt;script async src=&quot;//platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;hr&gt;

&lt;h1 id=&quot;1-はじめに&quot;&gt;1. はじめに&lt;/h1&gt;

&lt;h2 id=&quot;はじめにの前に&quot;&gt;はじめにの前に&lt;/h2&gt;

&lt;p&gt;先日はこんな発表をしました｡&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/pdf/tsukubapm3-luavm.html&quot;&gt;Tsukuba.pm #3 LuaのVM&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;内容はLua 5.2のVMのバイトコードを読むというもので､VMの命令とか定数をデコードするというものを作りました｡
もうすこしなんかやりたいところでしたね…｡&lt;/p&gt;

&lt;p&gt;他には面白い発表が聞けたので楽しかったです｡&lt;/p&gt;

&lt;h2 id=&quot;intro&quot;&gt;intro&lt;/h2&gt;

&lt;p&gt;さて､同イベントに参加した&lt;a href=&quot;https://twitter.com/_yyu_&quot;&gt;@_yyu_ &lt;/a&gt;さんにLuaのtableの実装について聞かれたんですが､そこまで詳しくなかったので答えられないというインシデントがありました｡
唯一のデータ構造といわれると確かにそこが気になるはずだ｡ちなみにScalaでは&lt;a href=&quot;https://en.wikipedia.org/wiki/Hash_array_mapped_trie&quot;&gt;HAMT&lt;/a&gt;という高速な操作ができるデータ構造が用意されているようだ｡&lt;/p&gt;

&lt;p&gt;さんざんLuaについて語っておいてそれはマズい､というわけでちょっとだけ調べた｡
実装の詳細については資料がなかったのでソースを読まざるを得ない､しかしCはもう読みたくない､ということで実装の詳細には迫れなかったが､動作の概略を今回は掴んでみたい｡&lt;/p&gt;

&lt;h1 id=&quot;2-luaのtableについて&quot;&gt;2. Luaのtableについて&lt;/h1&gt;

&lt;p&gt;今回はtableのhashとメモリ確保について｡&lt;/p&gt;

&lt;p&gt;Lua 4.0まではtableは完全にhash tableだったようですが､5.0以降はhash partとarray partという2つの構造を併せ持つハイブリッドな物体になっています｡
これにより&lt;code&gt;t[1]&lt;/code&gt;､&lt;code&gt;t[2]&lt;/code&gt;､…などは､arrayの&lt;code&gt;n&lt;/code&gt;番目という内部表現から得られるため､indexを保持する必要がなくなるなどの改善が得られました｡さて｡&lt;/p&gt;

&lt;h1 id=&quot;3-allocationとindex-key&quot;&gt;3. allocationとindex/key&lt;/h1&gt;

&lt;h2 id=&quot;3-1-key-or-index&quot;&gt;3-1. key or index?&lt;/h2&gt;

&lt;p&gt;では以下のようなコードはどないすんじゃヴォケという考えに至ります｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;voke&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;x&lt;/code&gt;の10000番目に値を入れるのか? 実はそうではない｡この場合&lt;code&gt;10000&lt;/code&gt;という&lt;em&gt;key&lt;/em&gt;に&lt;code&gt;&amp;quot;voke&amp;quot;&lt;/code&gt;というvalueが入るため､&lt;em&gt;&lt;code&gt;x&lt;/code&gt;のarray partの長さは0&lt;/em&gt;のままです｡&lt;/p&gt;

&lt;p&gt;数字は､プログラマーは､&lt;strong&gt;俺は､こいつはindexなのかkeyなのか&lt;/strong&gt;､という問題に頭を抱えます｡&lt;/p&gt;

&lt;h2 id=&quot;3-2-key-to-index&quot;&gt;3-2. key to index&lt;/h2&gt;

&lt;p&gt;数字の気持ちはともかく､プログラマーにはとりあえずなんとかわかりそうな気がしないでもない方法があります｡&lt;/p&gt;

&lt;p&gt;まずはarray partのサイズの確保について話します｡&lt;/p&gt;

&lt;p&gt;メモリ確保のタイミングはいつなのか｡
array partに関しては､以下のタイミングでメモリの確保が行われる｡&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;tableに一つ値が追加され､メモリ確保が必要となるとき､次のような&lt;code&gt;n&lt;/code&gt;が確保される｡

&lt;ul&gt;
&lt;li&gt;array partの&lt;code&gt;1&lt;/code&gt;〜&lt;code&gt;n&lt;/code&gt;のうち半分に値が入ってる&lt;/li&gt;
&lt;li&gt;&lt;code&gt;n/2+1&lt;/code&gt;〜&lt;code&gt;n&lt;/code&gt;のうち最低一つに値が入ってる&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;メモリの確保というのは､つまりより長いtableを作って突っ込んでいくということ｡ここで&lt;em&gt;keyが&lt;code&gt;n ≧ k&lt;/code&gt;となるnumber &lt;code&gt;k&lt;/code&gt;の場合､indexとして変換される&lt;/em&gt;｡&lt;/p&gt;

&lt;p&gt;せっかくなのでmoorを使ってみまつ｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ moor
moor on MoonScript version 0.4.0 on Lua 5.3
&amp;gt; t = {1, 2, 3}
&amp;gt; t[8] = 8
&amp;gt; table.remove t, 1
1
&amp;gt; t
{ 2, 3,
    [8] = 8
  }
&amp;gt; t2 = {1, 2, 3, 4}
&amp;gt; t2[8] = 8
&amp;gt; table.remove t2, 1
1
&amp;gt; t2
{ 2, 3, 4,
    [7] = 8
  }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;t&lt;/code&gt;では長さ3のarray partが定義時に作られます｡で､&lt;code&gt;t[8]&lt;/code&gt;に値を入れますが､上記のメモリ確保の方法からいくと長さ8まで取ってくれないので&lt;code&gt;8&lt;/code&gt;はindexではなくkeyとして保持されます｡
そのため､1番目の要素を&lt;code&gt;table.remove()&lt;/code&gt;で取り除いても&lt;code&gt;8&lt;/code&gt;は&lt;em&gt;key&lt;/em&gt;なので変わりません｡&lt;/p&gt;

&lt;p&gt;一方､&lt;code&gt;t2&lt;/code&gt;ではまず長さ4のarray partを定義時に用意しています｡それで&lt;code&gt;t[8]&lt;/code&gt;を突っ込むと､&lt;code&gt;n/2&lt;/code&gt;個の要素が使われてて&lt;code&gt;n/2+1&lt;/code&gt;〜&lt;code&gt;n&lt;/code&gt;の間に値が1つ以上ある&lt;code&gt;n&lt;/code&gt;がちょうど8なので､&lt;code&gt;8&lt;/code&gt;は&lt;em&gt;index&lt;/em&gt;になります｡
その証拠にほら､&lt;code&gt;8&lt;/code&gt;を格納してるindexが&lt;code&gt;7&lt;/code&gt;になってるだろう?&lt;/p&gt;

&lt;p&gt;次はメモリ確保のタイミングについての計測です｡
そろそろ飽きてきたのでちゃんと理解できてないうちに書いてみたやつを動かしてみます｡
何をしてるかというと､tableにガンガンものを突っ込んでるというだけで､tableの成長はサイズがでかいとちょっと時間がかかるというヤツですね｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sock&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;socket&#39;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;get_exectime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gettime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gettime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;printrangetime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;io.write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot; %10d 〜 %-10d (+%8d )\t&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_exectime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot; %10s    %-10s (  %7s )  %10s&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;from&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;to&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;div&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;sec&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;printrangetime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4999&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;printrangetime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;printrangetime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;printrangetime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;printrangetime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;printrangetime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot; &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;adding&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10001&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10001&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;printrangetime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5001&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;printrangetime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;printrangetime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4999&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;以下の実行結果が得られる｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ lua test.lua
       from    to         (      div )         sec
------------------------------------------------------------
          0 〜 4999       (+    4999 )  0.00021195411682129
       5000 〜 2097151    (+ 2092151 )  0.065406084060669
    2097152 〜 4194303    (+ 2097151 )  0.090538024902344
    4194304 〜 6291455    (+ 2097151 )  0.10658502578735
    6291456 〜 8388607    (+ 2097151 )  0.058128118515015
    8388608 〜 10485759   (+ 2097151 )  0.15600204467773
                   adding       2087151.0
   12572912 〜 12577911   (+    4999 )  0.00013303756713867
   12577912 〜 12582911   (+    4999 )  0.00014400482177734
   12582912 〜 12587911   (+    4999 )  0.00014877319335938
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;なるほど｡面白いのは最初(from 0 to 4999)のtableへの値の追加とケツの方ではあまり時間が変わらないんですねぇ｡
前者は短い内でのtableの成長が大量に起きるので若干遅くなっている｡&lt;/p&gt;

&lt;h1 id=&quot;4-おわりに&quot;&gt;4. おわりに&lt;/h1&gt;

&lt;p&gt;&lt;a href=&quot;https://twitter.com/_yyu_&quot;&gt;@_yyu_ &lt;/a&gt;さんが知りたいのは多分key-valueの保持とひも付けの方法だと思うんです､ボクもそれが知りたかった｡&lt;/p&gt;

&lt;h1 id=&quot;参考文献&quot;&gt;参考文献&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.lua.org/doc/jucs05.pdf&quot;&gt;The implementation of Lua 5.0&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr&gt;

&lt;p&gt;院に行くかどうかは確定的ではないが充分視野に入れているので､来月のTOEFLかTOEICかなんかがタダで受けられるらしいので頑張りたい｡
ということで&lt;a href=&quot;http://www.lua.org/wshop15.html&quot;&gt;Lua workshop 2015&lt;/a&gt;の発表をYoutubeで聞いてるわけですがポルトガルなまりの英語が難しいですおわり｡&lt;/p&gt;

&lt;p&gt;ところでTOEなんとかが終わるのが1300で､同日1630には&lt;a href=&quot;http://showbyrock-anime.com/news/20160501-1818/&quot;&gt;SB69一挙放送イベント&lt;/a&gt;に行くわけですが気持ち高まってんぞ､
その翌日はチケットがあたったら&lt;a href=&quot;http://www.particle.jp.net/rs_event/index.html&quot;&gt;りりくるのイベント&lt;/a&gt;にも行くので6月も全力だぞオイ&lt;/p&gt;
</description>
        <pubDate>Mon, 16 May 2016 00:00:00 +0900</pubDate>
        <link>http://nymphium.github.io/2016/05/16/luatable.html</link>
        <guid isPermaLink="true">http://nymphium.github.io/2016/05/16/luatable.html</guid>
        
        <category>Lua</category>
        
        
      </item>
    
      <item>
        <title>Luaでは関数外でもreturnが書ける､これな〜んでだ?</title>
        <description>&lt;p&gt;こんにちは､びしょ〜じょです｡&lt;/p&gt;

&lt;p&gt;昨日はやっとアイカツ2016年第4弾をやりました｡
｢馬鹿野郎お前俺は1万円は使うぞお前｣という気持ちで行ったんですが､2hほど筐体前で気持ちよくなってたけど結局3､4000円程度しか使えませんでした｡
実際文章をちゃんと読んで聞いてしてると1プレイが結構長いんですね､3ヶ月ぶりだったので忘れてました｡
結局1000円札5枚を100円玉50枚にしたら､全部使うことなく閉店時間になり小銭入れがパンパンのまま帰る羽目になりました｡&lt;/p&gt;

&lt;p&gt;データカードダス アイカツスターズ! は5月19日から! ということでまたやりに行こうと思います｡CPのスクールドレスは絶対にそろえたいなぁ､あときいちゃんが書いてあるやつ!&lt;/p&gt;

&lt;hr&gt;

&lt;h1 id=&quot;1-q-luaでは関数外でもreturnが書ける､これな〜んで&quot;&gt;1. Q. Luaでは関数外でもreturnが書ける､これな〜んで?&lt;/h1&gt;

&lt;p&gt;実はLuaでは関数外でも&lt;code&gt;retun&lt;/code&gt;書けるし構文的には何の問題もないんですねぇ…｡
Luaの予約語である&lt;code&gt;return&lt;/code&gt;は､CとかJavaなどと同じで､関数の戻り値を書くわけです(多値という違いはありますが)｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;c1&quot;&gt;-- foo.lua&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Hello&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;--!!!&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;......&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&quot;2-a-requireの戻り値に渡すため&quot;&gt;2. A. &lt;code&gt;require&lt;/code&gt;の戻り値に渡すため&lt;/h1&gt;

&lt;p&gt;実はなんてことない話で､&lt;code&gt;require(&amp;#39;foo&amp;#39;)&lt;/code&gt;したときの戻り値に&lt;code&gt;return 5&lt;/code&gt;が渡されるというだけです｡&lt;/p&gt;

&lt;p&gt;luaファイルは全て&lt;code&gt;require([[filename]])&lt;/code&gt;することでモジュールとして呼び出すことができ､&lt;code&gt;filename.lua&lt;/code&gt;の&lt;em&gt;戻り値&lt;/em&gt;､つまり&lt;code&gt;return ...&lt;/code&gt;が&lt;code&gt;require([[filename]])&lt;/code&gt;の戻り値になります｡
&lt;code&gt;filename.lua&lt;/code&gt;に戻り値がなければ&lt;code&gt;require([[filename]])&lt;/code&gt;は&lt;code&gt;true&lt;/code&gt;(または呼び出し時に失敗すれば&lt;code&gt;false&lt;/code&gt;)を返します｡&lt;/p&gt;

&lt;h1 id=&quot;3-関数との関係&quot;&gt;3. 関数との関係&lt;/h1&gt;

&lt;p&gt;さて､関数の&lt;code&gt;return&lt;/code&gt;と何か関係があるのではないか､という考えをするのが人間です｡
実はだいぶあります｡&lt;/p&gt;

&lt;p&gt;ところで､ここで関数のおさらいです｡以下の関数&lt;code&gt;f&lt;/code&gt;と&lt;code&gt;g&lt;/code&gt;は&lt;em&gt;全く&lt;/em&gt;同じ意味を持ちます｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;また､次の関数&lt;code&gt;f_&lt;/code&gt;と&lt;code&gt;g_&lt;/code&gt;は違います｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;c1&quot;&gt;-- f_ contains f_&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f_&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;f_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f_&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;-- g_ DOES NOT contains g_&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;g_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;g_&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;3-1-string-dump&quot;&gt;3-1. &lt;code&gt;string.dump&lt;/code&gt;&lt;/h2&gt;

&lt;p&gt;まず関係を示すために､ユーザー定義関数をバイナリ表現にしてくれる&lt;code&gt;string.dump&lt;/code&gt;について｡&lt;/p&gt;

&lt;p&gt;言ったまんまですが､定義した関数を渡すと､実際にLua VM上で動くバイトコードに変換してくれます｡
使いどころがよくわからない気もしますが､今が使い時です｡&lt;/p&gt;

&lt;p&gt;簡単な関数について考えてみます｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;kantannna_kansuu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;hello&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;string.dump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kantannna_kansuu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;これを実行するとよくわからない文字列が出力されます｡&lt;/p&gt;

&lt;p&gt;うーん､では&lt;em&gt;この文字列をファイルに吐き出して&lt;/em&gt;みましょう｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;kantannna_kansuu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;hello&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;assert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;io.open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;kantannna_kansuu.out&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;wb&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;string.dump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kantannna_kansuu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;じゃあ&lt;code&gt;lua&lt;/code&gt;で実行してみるか｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ lua kantannna_kansuu.out
hello   3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;はわわ､なんだかよくわからなくなってきました……｡&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;もう少し頑張ってください｡次のようなファイルを作ります｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;c1&quot;&gt;-- kantannna_kansuu.lua&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;hello&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;そうです､&lt;code&gt;kantannna_kansuu()&lt;/code&gt;の中身と同じです｡これをコンパイルします｡はい､Luaはコンパイラがあります｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;luac -o compiled_kantannna_kansuu.out kantannna_kansuu.lua
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;kantannna_kansuu.lua&lt;/code&gt;をLua VMのバイトコードにコンパイルし､&lt;code&gt;compiled_kantannna_kansuu.out&lt;/code&gt;というファイルに書き出しました｡&lt;/p&gt;

&lt;p&gt;ここで!! おもむろにバイナリエディタなどで&lt;code&gt;kantannna_kansuu.out&lt;/code&gt;と&lt;code&gt;compiled_kantannna_kansuu.out&lt;/code&gt;を見比べてみてください｡
実はこれ&lt;strong&gt;&lt;em&gt;全く同じ&lt;/em&gt;&lt;/strong&gt;なんですね｡&lt;/p&gt;

&lt;h1 id=&quot;4-関数の実態&quot;&gt;4. 関数の実態&lt;/h1&gt;

&lt;p&gt;&lt;code&gt;luac&lt;/code&gt;コマンドには便利なオプションがああります｡&lt;code&gt;luac -l luac.out&lt;/code&gt;でLua VMの挙動がわかります｡&lt;/p&gt;

&lt;p&gt;これで&lt;code&gt;kantannna_kansuu.out&lt;/code&gt;を見てみます｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ luac -l kantannna_kansuu.out
function &amp;lt;stdin:1,3&amp;gt; (5 instructions at 0x129ba30)
0 params, 3 slots, 1 upvalue, 0 locals, 3 constants, 0 functions
        1       [2]     GETTABUP        0 0 -1  ; _ENV &quot;print&quot;
        2       [2]     LOADK           1 -2    ; &quot;hello&quot;
        3       [2]     LOADK           2 -3    ; 3
        4       [2]     CALL            0 3 1
        5       [3]     RETURN          0 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;簡単に説明すると､&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;_ENV&lt;/code&gt;から&lt;code&gt;print&lt;/code&gt;をスタックに積む&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;quot;hello&amp;quot;&lt;/code&gt;をスタックに積む&lt;/li&gt;
&lt;li&gt;&lt;code&gt;3&lt;/code&gt;をスタックに積む&lt;/li&gt;
&lt;li&gt;関数呼び出し&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;といった感じでしょうか｡VMについてはまだわかってないので適当ですが､雰囲気としては問題ないはず｡&lt;/p&gt;

&lt;p&gt;あれ､お前､元は関数だったはずじゃ……これではただの実行ファイルじゃん｡&lt;/p&gt;

&lt;p&gt;そうなんです､Luaにおける関数とは､まさに&lt;strong&gt;引数をとる環境&lt;/strong&gt;と言えるわけですね〜､逆にファイルなど一つのLuaチャンクはただの関数なんですね｡&lt;/p&gt;

&lt;p&gt;これは以下の2関数について､&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;c1&quot;&gt;-- f_ contains f_&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f_&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;f_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f_&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;-- g_ DOES NOT contains g_&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;g_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;g_&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;f_&lt;/code&gt;はまず&lt;code&gt;_ENV&lt;/code&gt;に&lt;code&gt;f_&lt;/code&gt;を登録して､次に値を与えています｡このため､定義時に&lt;code&gt;_ENV.f_&lt;/code&gt;が存在はするため､戻り値に(&lt;code&gt;_ENV.&lt;/code&gt;)&lt;code&gt;f_&lt;/code&gt;を返せる｡
一方&lt;code&gt;g_&lt;/code&gt;は&lt;code&gt;g_&lt;/code&gt;自身の定義時に&lt;code&gt;_ENV&lt;/code&gt;に&lt;code&gt;g_&lt;/code&gt;がないため､戻り値は&lt;code&gt;g_&lt;/code&gt;(つまり&lt;code&gt;nil&lt;/code&gt;)ではなく&lt;code&gt;1&lt;/code&gt;になるんです｡&lt;/p&gt;

&lt;p&gt;｢引数を取る環境｣とか言っておいて引数のある関数について見てませんね｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;compound&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;compound.out&quot;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;assert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;io.open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;wb&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;string.dump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;compound&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;os.execute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;luac -l &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;function &amp;lt;stdin:1,3&amp;gt; (3 instructions at 0x155ea10)
2 params, 3 slots, 0 upvalues, 2 locals, 0 constants, 1 function
        1       [2]     CLOSURE         2 0     ; 0x155eae0
        2       [2]     RETURN          2 2
        3       [3]     RETURN          0 1

function &amp;lt;stdin:2,2&amp;gt; (7 instructions at 0x155eae0)
1 param, 4 slots, 2 upvalues, 1 local, 0 constants, 0 functions
        1       [2]     GETUPVAL        1 0     ; g
        2       [2]     GETUPVAL        2 1     ; f
        3       [2]     MOVE            3 0
        4       [2]     CALL            2 2 0
        5       [2]     TAILCALL        1 0 0
        6       [2]     RETURN          1 0
        7       [2]     RETURN          0 1
true    exit    0 # これは`os.execute()`の戻り値
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ウオア〜なんか2つ(?)出た､冷静に見てみよう｡&lt;/p&gt;

&lt;p&gt;上の方の命令に&lt;code&gt;CLOSURE&lt;/code&gt;というのがあるので､クロージャを作ってる&lt;code&gt;compound()&lt;/code&gt;がこれかな｡
下が､&lt;code&gt;compound()&lt;/code&gt;が返している関数の中身のようなので､これを見てみますと､まず&lt;code&gt;GETUPVAL&lt;/code&gt;で引数の&lt;code&gt;f&lt;/code&gt;と&lt;code&gt;g&lt;/code&gt;を取得しているようだ｡
&lt;code&gt;MOVE&lt;/code&gt;命令で&lt;code&gt;x&lt;/code&gt;を引っ張って&lt;code&gt;CALL&lt;/code&gt;してるように見えるおわり｡&lt;/p&gt;

&lt;h1 id=&quot;5-おわりに&quot;&gt;5. おわりに&lt;/h1&gt;

&lt;p&gt;｢だから何だ｣という話ですが､クイズの答えとその解説というだけで､どうするかは考えてください｡&lt;/p&gt;

&lt;h2 id=&quot;あわせて読みたい&quot;&gt;あわせて読みたい&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://luaforge.net/docman/83/98/ANoFrillsIntroToLua51VMInstructions.pdf&quot;&gt;A No-Frills Introduction to Lua 5.1 VM instructions&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Lua VMの命令の解説です｡Lua 5.1に関するものですが､VM自体は5.3になってもあまり進化してない(気がする)ので､現在でも使える知識です｡&lt;/p&gt;

&lt;p&gt;この記事と関係があるかないかで言うと､今ボクが読んでます｡&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;&lt;a href=&quot;http://connpass.com/event/30661/&quot;&gt;Tsukuba.pm #3&lt;/a&gt;で話すことになりました｡
&lt;a href=&quot;https://twitter.com/VienosNotes&quot;&gt;@VienosNotes &lt;/a&gt;さんはボクがPerl書けないことは知ってるはずですが声をかけてもらったので､堂々とLuaについて話します｡よろしくお願いします｡&lt;/p&gt;
</description>
        <pubDate>Mon, 25 Apr 2016 00:00:00 +0900</pubDate>
        <link>http://nymphium.github.io/2016/04/25/luaquiz.html</link>
        <guid isPermaLink="true">http://nymphium.github.io/2016/04/25/luaquiz.html</guid>
        
        <category>Lua</category>
        
        
      </item>
    
      <item>
        <title>りりくるRSは最高</title>
        <description>&lt;p&gt;草は緑 空は青 りりくる Rainbow Stage!!! は最高
&lt;div align=&quot;center&quot;&gt;
&lt;a href=&quot;http://www.particle.jp.net/&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;http://www.particle.jp.net/lilycle_rs/banner/600150_05.jpg&quot; width=&quot;600&quot; height=&quot;150&quot; alt=&quot;『りりくる Rainbow Stage!!!』応援中！2016年4月28日発売予定！&quot; border=&quot;0&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;&lt;/p&gt;
</description>
        <pubDate>Sat, 23 Apr 2016 00:00:00 +0900</pubDate>
        <link>http://nymphium.github.io/2016/04/23/lilycle.html</link>
        <guid isPermaLink="true">http://nymphium.github.io/2016/04/23/lilycle.html</guid>
        
        <category>百合</category>
        
        
      </item>
    
      <item>
        <title>awesome WMでタイマー</title>
        <description>&lt;p&gt;こんにちは､びしょ〜じょです｡映画プリパラとミルキィホームズを観てきました｡連続で森脇ふでやすペアの作品は疲れますね｡&lt;/p&gt;

&lt;h1 id=&quot;1-はじめに&quot;&gt;1. はじめに&lt;/h1&gt;

&lt;p&gt;世の中にはこんな便利なLuaモジュールがあります｡&lt;/p&gt;

&lt;div class=&quot;github-widget&quot; data-repo=&quot;nymphium/luakatsu&quot;&gt;&lt;/div&gt;

&lt;p&gt;ところでawesomeというLuaで設定ファイルを記述できるウィンドウマネージャがあります｡ピンときましたね｡&lt;/p&gt;

&lt;p&gt;そうですね､&lt;em&gt;お誕生日にメッセージが出る&lt;/em&gt;とハッピーですね｡&lt;/p&gt;

&lt;h1 id=&quot;2-awesome-timer-api&quot;&gt;2. awesome timer API&lt;/h1&gt;

&lt;p&gt;awesomeには実はtimer APIというものがあったんですねぇ…｡&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://awesomewm.org/doc/api/modules/timer.html#timer&quot;&gt;awesome API Document: timer module&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;せっかくなのでちょっとみてみます｡ドキュメントは(個人的に)初見だと若干不親切だったので補足ッピよ｡&lt;/p&gt;

&lt;h2 id=&quot;table&quot;&gt;table&lt;/h2&gt;

&lt;h3 id=&quot;timer&quot;&gt;timer&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;timer&lt;/code&gt;はtableですが､オブジェクト指向のクラスだと思ってください｡
awesome実行時に_Gに展開されます｡
&lt;code&gt;{timeout = N}&lt;/code&gt;というtableを渡すことでインスタンスを生成します｡
この&lt;code&gt;N&lt;/code&gt;は､number型で､N秒ごとにこのインスタンスに登録されているイベントを､やっていく｡
また､読み取り専用でインスタンスには&lt;code&gt;started&lt;/code&gt;というbool型のメンバ変数があり､インスタンスのタイマーが開始されているか(後述)がわかります｡&lt;/p&gt;

&lt;p&gt;このtimreインスタンスにイベントを追加していくということです｡&lt;/p&gt;

&lt;h2 id=&quot;function&quot;&gt;function&lt;/h2&gt;

&lt;h3 id=&quot;t-start&quot;&gt;t:start()&lt;/h3&gt;

&lt;p&gt;timerのインスタンスtを開始します｡これによりtのタイマーが起動し､&lt;code&gt;t.timeout&lt;/code&gt;秒ごとにイベントを繰り出します｡
&lt;code&gt;T:f()&lt;/code&gt;は&lt;code&gt;T.f(T)&lt;/code&gt;の糖衣構文なのでもちろん&lt;code&gt;timer.start(t)&lt;/code&gt;とすることもできます｡&lt;/p&gt;

&lt;p&gt;このとき､&lt;code&gt;t.started&lt;/code&gt;は&lt;code&gt;true&lt;/code&gt;となります｡&lt;/p&gt;

&lt;h3 id=&quot;t-stop&quot;&gt;t:stop()&lt;/h3&gt;

&lt;p&gt;インスタンスtのタイマーを止めます｡&lt;/p&gt;

&lt;p&gt;このとき､&lt;code&gt;t.started&lt;/code&gt;は&lt;code&gt;false&lt;/code&gt;となります｡&lt;/p&gt;

&lt;h3 id=&quot;t-again&quot;&gt;t:again()&lt;/h3&gt;

&lt;p&gt;止まっているtを再開します｡&lt;/p&gt;

&lt;h3 id=&quot;t-connect_signal-signame-func&quot;&gt;t:connect_signal(signame, func)&lt;/h3&gt;

&lt;p&gt;これがイベントの追加関数です｡&lt;code&gt;signame&lt;/code&gt;にはstring型でsignal名を追加します｡
signal is 何な人はawesome のsignalを学んでほしい｡と言いたいところですが､timerは&lt;code&gt;&amp;quot;timeout&amp;quot;&lt;/code&gt;signalを見るので､ここは&lt;code&gt;&amp;quot;timeout&amp;quot;&lt;/code&gt;とでもしておいてください｡
&lt;code&gt;func&lt;/code&gt;には関数を追加します｡この登録する関数は第1引数にtを取ります｡第2引数以降にブツをわたしたいときは､後述の&lt;code&gt;t:emmit_signal()&lt;/code&gt;を使います｡&lt;/p&gt;

&lt;h3 id=&quot;t-disconnect_signal-signame-func&quot;&gt;t:disconnect_signal(signame, func)&lt;/h3&gt;

&lt;p&gt;イベントを削除します｡&lt;code&gt;signame&lt;/code&gt;は上記と同じですね｡&lt;code&gt;&amp;quot;timeout&amp;quot;&lt;/code&gt;としておいてください｡
&lt;code&gt;func&lt;/code&gt;ですが､例えば&lt;code&gt;foo&lt;/code&gt;という関数を登録した場合､&lt;code&gt;t:disconnect_signal(&amp;quot;timeout&amp;quot;, foo)&lt;/code&gt;としないといかんのですな｡&lt;/p&gt;

&lt;p&gt;ところでLuaでは各関数にidが振ってあります｡
&lt;code&gt;tostring(foo)&lt;/code&gt;などしてみるとidが伺えます｡
これはtableも同じで､中身が同じでもidが異なると､&lt;code&gt;foo == bar&lt;/code&gt;は&lt;code&gt;false&lt;/code&gt;を返します｡&lt;/p&gt;

&lt;p&gt;なにが言いたいかというと､&lt;code&gt;disconnect_signal()&lt;/code&gt;の第2引数には登録した関数そのものを渡したいので
､イベントを削除したい場合は&lt;code&gt;connect_signal()&lt;/code&gt;に無名関数を渡すのはまずく､適当な変数にバインドしてください｡&lt;/p&gt;

&lt;h3 id=&quot;t-emit_signal-signame&quot;&gt;t:emit_signal(signame, ...)&lt;/h3&gt;

&lt;p&gt;インスタンスtの&lt;code&gt;signame&lt;/code&gt; signalに登録されている関数すべてを適用します｡各関数の第1引数にはtが､それ以降には&lt;code&gt;...&lt;/code&gt;が渡されます｡&lt;/p&gt;

&lt;h3 id=&quot;timer-instances&quot;&gt;timer.instances()&lt;/h3&gt;

&lt;p&gt;timer全体で登録されているイベントの数を返します｡インスタンス毎じゃないぞ､timer全体だぞ｡なので引数はいりません｡&lt;/p&gt;

&lt;h1 id=&quot;3-実装&quot;&gt;3. 実装&lt;/h1&gt;

&lt;p&gt;まず考えよっか｡&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;luakatsuの&lt;code&gt;find_birthday()&lt;/code&gt;を使います｡&lt;code&gt;find_birthday(today)&lt;/code&gt;でアイドル情報が帰ってきたらそれを出力します｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idol&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Aikatsu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;find_birthday&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;os.date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;%m/%d&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idol&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;awesomeの通知モジュールというとnaughtyです｡これは&lt;code&gt;naughty.notify {title = ..., text = ...}&lt;/code&gt;といった感じで､うん｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;n&quot;&gt;naughty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;notify&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;title&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;notificatoin&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;今日は&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idol&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ちゃんの誕生日だよ!&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;これを関数にして､例えば毎日0000､0600､1200､1800あたりに発火してみます｡
でもこのままだと起動時即&lt;code&gt;t:start()&lt;/code&gt;するとよくわからない時間に通知が出ますね｡調節します｡&lt;/p&gt;

&lt;p&gt;区切りのいい時間になったら通知タイマーを開始させるタイマーを作ってみます｡
パディング用のタイマーのtimeoutをうまくやります｡とりあえずベタな方法でいってみます｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;now&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;os.date&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;*t&quot;&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hour&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;21600&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;21600&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;elseif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;43200&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;43200&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;elseif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;64800&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;64800&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;elseif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;86400&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;86400&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;次に行く前に通知タイマーを作ってしまおう｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;luakatsutime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;21600&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- every 6 hours&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;luakatsutimer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connect_signal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;timeout&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;celebrate_notify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;登録する関数はこんな感じですか｡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;padding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Luaは外のブロックで定義された変数も見えるので特に必要はないですが高階関数にしてあります｡
実際に実行したいタイマー&lt;code&gt;timer&lt;/code&gt;を引数にとり､期を待ちます｡
第一引数には登録したインスタンスが来るので､&lt;code&gt;self&lt;/code&gt;で受けます｡で､中で&lt;code&gt;stop()&lt;/code&gt; &amp;amp; &lt;code&gt;start()&lt;/code&gt;｡&lt;/p&gt;

&lt;p&gt;この関数をパディング用タイマーに登録してさっきの泥臭い手法で計算した&lt;code&gt;sec&lt;/code&gt;秒後に発火させておわり｡&lt;/p&gt;

&lt;h2 id=&quot;3-1-全体&quot;&gt;3-1. 全体&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;package.path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;package.path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LUAKATSU_PATH&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;naughty&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;naughty&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;naughty&#39;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;timer&#39;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;luakatsu&#39;&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tsig&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;timeout&quot;&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;oiwai&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;today&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;os.date&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;*t&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;today&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;md&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;%02d/%02d&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;today&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;month&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;today&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;day&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idol&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Aikatsu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;find_birthday&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;today&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;md&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idol&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;naughty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;notify&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;title&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;today&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;month&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;がつ&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;today&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;day&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;にち&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;今日は&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idol&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ちゃんのお誕生日だよ!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;whdth&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;160&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;fg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ff0000&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- 黄色背景に赤文字でアイカツ感を出す&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;bg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ffff00&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;run&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- notificatoinをクリックするとお祝いツイートができる&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;awful&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;util&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;spawn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
                            &lt;span class=&quot;s2&quot;&gt;&quot;xdg-open https://twitter.com/intent/tweet?text=&quot;&lt;/span&gt;
                            &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idol&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gsub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;%s&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;+&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                            &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ちゃん誕生日おめでとう!&quot;&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;naughty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destroy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- そして消える&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;luakatsutimer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;21600&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- every 6 hours&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;luakatsutimer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connect_signal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tsig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;celebrate_notify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;now&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;os.date&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;*t&quot;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hour&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;21600&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;21600&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;elseif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;43200&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;43200&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;elseif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;64800&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;64800&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;elseif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;86400&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;86400&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;celebrate_notify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- 起動時にも出したい&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;padding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;paddingtimer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;paddingtimer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connect_signal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tsig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;padding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;luakatsutimer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;paddingtimer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;実装の全体図です｡
awesome-clientなどで&lt;code&gt;error(pcakage.path)&lt;/code&gt;などdirtyな方法で&lt;code&gt;package.path&lt;/code&gt;をさっと確認してもらえればわかりますが､luakatsuなどがありそうなパスは読んでくれませんね｡
ということで､&lt;code&gt;package.path&lt;/code&gt;にパスを追加します｡設定ファイル内の名前空間を汚したくないので､&lt;code&gt;do ... end&lt;/code&gt;でくくっています｡&lt;/p&gt;

&lt;h1 id=&quot;4-demo&quot;&gt;4. demo&lt;/h1&gt;

&lt;blockquote class=&quot;twitter-tweet&quot;&gt;&lt;p lang=&quot;ja&quot; dir=&quot;ltr&quot;&gt;awesomeでやっとちゃんとした定刻での自動通知ができた｡ &lt;a href=&quot;https://t.co/AIxhOJrmJb&quot;&gt;pic.twitter.com/AIxhOJrmJb&lt;/a&gt;&lt;/p&gt;&amp;mdash; びしょ～じょ (@Nymphium) &lt;a href=&quot;https://twitter.com/Nymphium/status/711097741535895552&quot;&gt;March 19, 2016&lt;/a&gt;&lt;/blockquote&gt;

&lt;script async src=&quot;//platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;p&gt;今日は3/19で､あいにくアイカツキャラで誕生日の人はいませんでした｡が､アイマスなら人間が多いので今日もだれか誕生日だろうという予想がずばりあたり､後略&lt;/p&gt;

&lt;h1 id=&quot;5-おわりに&quot;&gt;5. おわりに&lt;/h1&gt;

&lt;p&gt;awesomeは実はまだまだ機能が豊富なんですよねぇ〜使ってない機能は多々あるのでガンガン発掘していきたい｡
awesomeは今年に入ってから3.5.6→3.5.9と開発がぐんぐん進んでいるので注目していきたい｡&lt;/p&gt;

&lt;p&gt;おわりだよー(○・▽・○)&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;明日はアイカツのあれのライブですが､自由席で整理番号がなんと41番だったのでやっぱり日頃の行いがな〜最高〜〜&lt;/p&gt;
</description>
        <pubDate>Sat, 19 Mar 2016 00:00:00 +0900</pubDate>
        <link>http://nymphium.github.io/2016/03/19/awesome_timer.html</link>
        <guid isPermaLink="true">http://nymphium.github.io/2016/03/19/awesome_timer.html</guid>
        
        <category>awesome</category>
        
        <category>Lua</category>
        
        
      </item>
    
  </channel>
</rss>
